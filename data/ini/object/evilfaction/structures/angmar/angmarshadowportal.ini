;------------------------------------------------------------------------------
Object AngmarShadowPortal
	  
	SelectPortrait = EMShadowPortal


	Draw = W3DScriptedModelDraw ModuleTag_Draw
		DefaultModelConditionState
		  Model = FBEntmoot
                  Texture = FBEntmoot.tga auswampskn.tga
                  Texture = FBEntmootFL.tga augllweedskn.tga
                  ParticleSysBone = None ShadowPortalFog
		  ParticleSysBone = None ShadowPortalMist
		  ParticleSysBone = None ShadowPortalMist2
		  ParticleSysBone = None ShadowPortalMist3
		End

	IdleAnimationState
	End	

	ModelConditionState   = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model               = FBEntmoot_A
                Texture = FBEntmoot.tga auswampskn.tga
                Texture = FBEntmootFL.tga augllweedskn.tga
	End

	ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Model               = FBEntmoot_A
                Texture = FBEntmoot.tga auswampskn.tga
                Texture = FBEntmootFL.tga augllweedskn.tga
	End
	AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
		Animation           = FBEntmoot_A
			AnimationName     = FBEntmoot_A.FBEntmoot_A
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
		End
		Flags				  = START_FRAME_FIRST
		StateName			  = BeingConstructed
		BeginScript
			CurDrawablePlaySound("GondorBarracksBeginConstruction")
			CurDrawablePlaySound("EntMootConstruction")
		EndScript
	End
    
	ModelConditionState  = DAMAGED
		Model         = FBEntmoot
                Texture = FBEntmoot.tga auswampskn.tga
                Texture = FBEntmootFL.tga augllweedskn.tga
		ParticleSysBone NONE EntImpactDebris

	End

    AnimationState = DAMAGED
	EnteringStateFX	= FX_BuildingDamaged
    End
		ModelConditionState  = REALLYDAMAGED
			Model         = FBEntmoot_D2
			ParticleSysBone NONE EntImpactDebris
                Texture = FBEntmoot.tga auswampskn.tga
                Texture = FBEntmootFL.tga augllweedskn.tga
		End

    AnimationState = REALLYDAMAGED
	EnteringStateFX	= FX_BuildingReallyDamaged
    End

    ModelConditionState  = RUBBLE
        Model         = FBEntmoot_D3
        ParticleSysBone NONE EntMootDeath
        ParticleSysBone NONE EntMootDeathSmoke
    End
  End
	
  Draw = W3DFloorDraw ModuleTag_DrawFloor    
     ModelName = KBMill_bib
     ;WeatherTexture = SNOWY auswampskn.tga
  End
  
  Draw = W3DScriptedModelDraw ModuleTag_Draw_HCBanner
    OkToChangeModelColor  = Yes
		DefaultModelConditionState
			Model = None
		End
		ModelConditionState = USER_3
		    Model = RBHCEntMoot
                    Texture = FBEntmoot.tga auswampskn.tga
                    Texture = FBEntmootFL.tga augllweedskn.tga
		End
    ;MultiPlayerOnly = Yes 
  End

	Draw = W3DScriptedModelDraw ModuleTag_DrawMurderOfCrows
		
		DefaultModelConditionState
			Model           = None		
		End
		
		ModelConditionState = FORTRESS_IMPROVEMENT_2
			Model		= Crebain_SKN
			Texture         = CUBird01.tga augrcrowskn.tga
		End

		AnimationState	= FORTRESS_IMPROVEMENT_2
			Animation	= WBFBCloud
				AnimationName	= Crebain_SKL.Crebain_IDLB
				AnimationMode	= LOOP
			End
			Flags				= START_FRAME_FIRST
		End
	End

  Draw = W3DScriptedModelDraw ModuleTag_DrawSkeleton
    DefaultModelConditionState
      Model = MUSkelton
    End
  End

	Draw = W3DScriptedModelDraw Draw_BonusEffects
	    DefaultModelConditionState
	      Model = None
	    End
	    AnimationState = ACTIVELY_BEING_CONSTRUCTED
	    End
		AnimationState = UPGRADE_ECONOMY_BONUS
			ParticleSysBone	= None FueltheFiresEmbers
		End
	End
  
  PlacementViewAngle  = 45
 
 
	;// ***DESIGN parameters ***
	DisplayName         	= EVILMOD:AngmarShadowPortal
	Description 	      	= EVILMOD:AngmarShadowPortalDes
	Side                	= Angmar
	EditorSorting       	= STRUCTURE
	ThreatLevel				= 1.0
	 
	BuildCost           	= EVILMOD_PORTAL_COST
	BuildTime           	= SHADOW_PORTAL_TIME           ;// in seconds
	BountyValue				= 150
	VisionRange         	= ISENGARD_WARG_SENTRY_VISIONRANGE          ;// Shroud clearing distance
	ShroudClearingRange 	= ISENGARD_WARG_SENTRY_SHROUDCLEAR

	CommandSet = AngmarPortalCommandSet
	
	ArmorSet
		Conditions        = None
		Armor             = PortalsArmor
	End

	;// *** AUDIO Parameters ***
	#include "..\..\..\includes\StandardBuildingEvaEvents.inc"

	//VoiceFullyCreated				= EVA:SwampComplete
	//VoiceSelect						= SwampBuildingSelect
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

    SoundAmbient			= ShadowPortalAmbience
    SoundOnDamaged			= BuildingLightDamageWood
    SoundOnReallyDamaged	= BuildingHeavyDamageWood

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
 		AnimationSound = Sound:EntMootConstructionBoulderSmallRise Animation:FBEntmoot_A.FBEntmoot_A Frames:92 168 254 336 399 474 551 634 705 795 860 885
 		AnimationSound = Sound:EntMootConstructionBoulderLargeRise Animation:FBEntmoot_A.FBEntmoot_A Frames:910
	End


	CampnessValue = CAMPNESS_DEFENSIVE_TOWER
    ;VoiceFullyCreated = EVA:WargSentryComplete

	;// *** ENGINEERING Parameters ***

	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE FS_FACTORY NEED_BASE_FOUNDATION CASTLE_KEEP MADE_OF_WOOD
	 
	Behavior            = GettingBuiltBehavior ModuleTag_04
		WorkerName					= MordorWorkerNoSelect
		SelfBuildingLoop			= BuildingConstructionLoop	// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound					// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= BuildingConstructionLoop
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth               = 22000
		MaxHealthDamaged        = 1500
		MaxHealthReallyDamaged  = 800
	End

	
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End

	Behavior                  = StructureCollapseUpdate ModuleTag_StructureCollapseUpdate 
		MinCollapseDelay        = 000
		MaxCollapseDelay        = 000
		CollapseDamping         = .5
		MaxShudder              = 0.6
		MinBurstDelay           = 250
		MaxBurstDelay           = 800
		BigBurstFrequency       = 4
		FXList                  = INITIAL   FX_StructureMediumCollapse
		FXList                  = ALMOST_FINAL  FX_StructureAlmostCollapse
		DestroyObjectWhenDone	= Yes
		CollapseHeight			= 0
	End

	Behavior = QueueProductionExitUpdate ModuleTag_11
	   UnitCreatePoint		= X:0.0 Y:0.0 Z:0.0
		NaturalRallyPoint	= X:80.0 Y:80.0 Z:0.0
		ExitDelay			= 3000 ; Mainly for the multiple produced Red Guard.  Make them come out one at a time.
	End
		
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		GiveNoXP = No
	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius			= 60		// How far we try to claim ground
		MaxIncome		= 0			// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= 999999	// How often (in msec) we give that much money
		HighPriority	= Yes		// A high priority claim gets to pretend it was there first.
		Visible = No 		;// Don't show decal when a resource building is selected.
	End

	
	;//Warg purchasing behaviors

	Behavior = SubObjectsUpgrade Armor_NewFloor
		TriggeredBy		= Upgrade_AngmarFaction
		UpgradeTexture	= FBEntmoot.tga 0 auswampskn.tga
		RecolorHouse	= Yes
	End

       

        ;;;GORCROWS UPGRADE;;;

	//Behavior = ModelConditionUpgrade ModuleTag_ShowGorgrows
	//	TriggeredBy					= Upgrade_AngmarMewlipSwampGorcrows	
	//	AddConditionFlags			= FORTRESS_IMPROVEMENT_2		
	//End

	

	Behavior = StealthDetectorUpdate StealthDetectorUpdateModuleTag
		DetectionRange		= 400									;// range to detect
		DetectionRate		= 600									;// how often to rescan for stealthed things in my sight (msec)
		//RequiredUpgrade		= 
	End

	Behavior = SpawnBehavior ModuleTag_Spawn
		SpawnNumber		= 14
		InitialBurst		= 14
		SpawnTemplateName	= BarrowWight_SlavedPortal
		SpawnReplaceDelay	= 15000
		CanReclaimOrphans	= Yes
	End
	
	Behavior = SpawnBehavior ModuleTag_Spawn2
		SpawnNumber		= 5
		InitialBurst		= 5
		SpawnTemplateName	= BarrowWight_SlavedPortal2
		SpawnReplaceDelay	= 5000
		CanReclaimOrphans	= Yes
	End

	;//Shadow Mist
	Behavior = InvisibilityUpdate ModuleTag_BroadcastCamouflage
		InvisibilityNugget
			InvisibilityType	= CAMOUFLAGE
			DetectionRange		= 5
		End
		UpdatePeriod			= 1000
		Broadcast				= Yes
		BroadcastRange			= 400
		BroadcastObjectFilter	= ALL
		StartsActive			= Yes
		//RequiredUpgrades		= Upgrade_ElvenFortressBlessedMist
	End
	

  Scale = 0.7

; This is the sundial rock
  Geometry              = CYLINDER
  GeometryMajorRadius   = 90 
  GeometryMinorRadius   = 40  
  GeometryHeight        = 20
  GeometryOffset	= X:0 Y:0 Z:0 
  AdditionalGeometry    = CYLINDER
  GeometryMajorRadius   = 17  
  GeometryMinorRadius   = 17   
  GeometryHeight        = 10
  GeometryOffset	= X:0 Y:80 Z:0 
  AdditionalGeometry    = CYLINDER
  GeometryMajorRadius   = 10  
  GeometryMinorRadius   = 10   
  GeometryHeight        = 42
  GeometryOffset	= X:0 Y:36 Z:0 
  AdditionalGeometry    = CYLINDER
  GeometryMajorRadius   = 10  
  GeometryMinorRadius   = 10   
  GeometryHeight        = 10
  
  
  GeometryIsSmall       = No
  Shadow                = SHADOW_VOLUME
  BuildCompletion     	= PLACED_BY_PLAYER
  
	GeometryContactPoint	= X:-88.153		Y:-47.964	Z:0		Repair
	GeometryContactPoint	= X:96.098		Y:-2.258	Z:0		Repair
	GeometryContactPoint	= X:17.21		Y:-88.654	Z:0
	GeometryContactPoint	= X:-23.526		Y:82.402	Z:0
	GeometryContactPoint	= X:1.53		Y:42.268	Z:40.231	Swoop

End


;-----------------------------------------------------------------

Object BarrowWight_SlavedPortal
	; *** ART Parameters ***

	SelectPortrait = UPBarrowWight
	ButtonImage  =  BCWightLair_BarrowWight

	Draw = W3DScriptedModelDraw ModuleTag_Draw
      
	RandomTextureFixedRandomIndex	= Yes ; -stupid
	RandomTexture	= SumnDragon_C.tga 0  cuwight.tga
	RandomTexture	= cuwight2.tga 0  cuwight.tga
	

		DefaultModelConditionState
			Model               = CUWight_SKN
			Skeleton            = CUWight_SKL
            		ParticleSysBone = NONE WTrails FollowBone:no
			
 		End
 

				
 		; ------------------------ Wight Anims -------------------------
		
		AnimationState							= FREEFALL 
			Animation							= FLYA
				AnimationName					= CUWight_FLYA
				AnimationMode					= LOOP
				AnimationBlendTime				= 5
			End
		End
		
		;//Normal Swipe Attack
		AnimationState        = FIRING_OR_PREATTACK_A 
			Animation           = ATKA
				AnimationName     = CUWight_ATKA
				AnimationMode     = ONCE
				UseWeaponTiming	  = Yes
			End
			StateName           = Attack
		End
		
		AnimationState        = MOVING 
			Animation           = RUNA
				AnimationName     = CUWight_RUNA
				AnimationMode     = LOOP
			End
			Flags               = RANDOMSTART
		End
		
		AnimationState							= SPLATTED
			Animation							= LNDA
				AnimationName					= CUWight_LNDA
				AnimationMode					= ONCE
			End
		End
		
		AnimationState = DYING
			Animation = DIEA
				AnimationName = CUWight_DIEA
			    AnimationMode = ONCE
				AnimationPriority = 1
			End
		End		
		
		AnimationState        = STUNNED_STANDING_UP 
			Animation           = GTPA
				AnimationName     = CUWight_GTPA
				AnimationMode     = ONCE
			End
		End

		AnimationState        = STUNNED 
			Animation           = LNDA
				AnimationName     = CUWight_LNDA
				AnimationMode     = ONCE
			End
		End
		
		; --------- Hit Reactions ------------
		AnimationState = HIT_REACTION HIT_LEVEL_1 
			Animation = Hit_Level_1_a
				AnimationName = CUWight_HITA
				AnimationMode = ONCE
			End
		End		
		
		;-emotions--
		
		AnimationState							= EMOTION_TAUNTING 
			Animation							= TNTA
				AnimationName					= CUWight_TNTA
				AnimationMode					= LOOP
			End
		End
	
		AnimationState							= EMOTION_CELEBRATING 
			Animation                           = CHRA
				AnimationName					= CUWight_CHRA
				AnimationMode					= ONCE
			End
		End

 		IdleAnimationState
			Animation = IDLA
				AnimationName		= CUWight_IDLA
				AnimationMode		= ONCE
				AnimationBlendTime	= 30
				AnimationPriority	= 1 ;2
			End
			Animation = IDLB
				AnimationName		= CUWight_IDLB
				AnimationMode		= ONCE
				AnimationBlendTime	= 30
				AnimationPriority	= 20
			End
		End		

	End
	
	; ---------------------------- End Wight Anims --------------------------------
	
	; ***DESIGN parameters ***
	Side				= Angmar
	EditorSorting		= UNIT
	ThreatLevel			= 1.0
	VisionRange			= 175.0
	ShroudClearingRange	= 200.0
	DisplayName			= OBJECT:BarrowWight
	CrushableLevel		= 2  ;What am I?:        0 = for infantry, 1 = for trees, 2 = general vehicles
	BuildCost			= 1
	BuildTime			= 1
	CommandPoints 			= 1
	TransportSlotCount	= TRANSPORTSLOTCOUNT_UNIT
	
	WeaponSet
		Conditions			= None 
		Weapon				= PRIMARY    BarrowWightTouch
		AutoChooseSources	= PRIMARY FROM_PLAYER FROM_SCRIPT FROM_AI
	End

	ArmorSet
		Conditions      = None
		Armor           = Barrow_special_armor
		DamageFX        = NormalDamageFX
	End


	; *** AUDIO Parameters ***;

	VoiceAttack				= BarrowWightVoxAttack
	VoiceGuard				= BarrowWightVoxAttack
	VoiceCreated			= EVA:BarrowWightCreated
	VoiceCreated			= +SOUND:BarrowWightVoxCreated
	VoiceFullyCreated		= EVA:BarrowWightCreated
	VoiceFullyCreated		= +SOUND:BarrowWightVoxCreated
	VoiceMove				= BarrowWightVoxSelect
	VoicePriority			= 15
	VoiceSelect				= BarrowWightVoxSelect

	SoundAmbient			= BarrowWightAmbienceMS
	SoundImpact				= ImpactHorse
	;SoundMoveStart			= BarrowWightMoveStart

	UnitSpecificSounds
		VoiceGarrison						= BarrowWightVoxSelect
		VoiceEnterUnitElvenTransportShip	= BarrowWightVoxSelect
		VoiceEnterUnitEvilMenTransportShip	= BarrowWightVoxSelect
		VoiceEnterUnitMordorMumakil			= BarrowWightVoxSelect
		VoiceEnterUnitSlaughterHouse		= BarrowWightVoxSelect
		VoiceInitiateCaptureBuilding		= BarrowWightVoxSelect
	End

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"


	; *** ENGINEERING Parameters ***

	RadarPriority	= UNIT
	KindOf			= PRELOAD MONSTER CREEP SCORE CAN_ATTACK ATTACK_NEEDS_LINE_OF_SIGHT ENVIRONMENT SELECTABLE SCARY
	CommandSet		= EmptyCommandSet
	
	Behavior = RadiateFearUpdate ModuleTag_GoldenArrowDaylightUpdate
		EmotionPulseRadius			= 200
		EmotionPulseInterval		= 1000
		GenerateFear				= Yes
		InitiallyActive				= Yes
		VictimFilter				= ALL ENEMIES
	End

	Behavior = StancesBehavior ModuleTag_StancesBehavior
        StanceTemplate = FighterHorde
    End

	Behavior = AIUpdateInterface ModuleTag_03
		AutoAcquireEnemiesWhenIdle	= Yes
		MoodAttackCheckRate			= 500
		MaxCowerTime				= 7500
		MinCowerTime				= 5000
		AILuaEventsList				= BarrowWightFunctions
	End
	
	Behavior = EmotionTrackerUpdate	Module_EmotionTracker
		AddEmotion	=	Terror_Base
		AlwaysAfraidOf			= NONE +CloudBreakSunbeam +SunflareSunbeam
		AddEmotion	=	Alert_Base
		IgnoreVeterancy			= Yes
	End

	LocomotorSet
		Locomotor = BarrowWightLocomotor
		Condition = SET_NORMAL
		Speed     = 45
	End

	Body = ActiveBody ModuleTag_Body
		MaxHealth = 300
	End
	
	Behavior = PhysicsBehavior ModuleTag_04
		GravityMult = 1.0
	End
	
//невидимый
Behavior = InvisibilityUpdate ModuleTag_StealthForEscape
		InvisibilityNugget
			InvisibilityType			= CAMOUFLAGE
			ForbiddenConditions			= FIRING_ANY
			BecomeStealthedFX       	= FX_ElvenCloakOn
			ExitStealthFX           	= FX_ElvenCloakOff
			DetectionRange				= 40
			HintDetectableConditions    = IS_FIRING_WEAPON
		End
		StartsActive					= Yes
		UpdatePeriod					= 2000
	End

	Behavior = SlowDeathBehavior ModuleTag_05
		DeathTypes			= ALL 
		SinkDelay			= 0
		SinkRate			= -2.0     ; in Dist/Sec
		DestructionDelay	= 3000
		FX					= INITIAL FX_SmallSpiderDie
		Sound				= INITIAL BarrowWightVoxDie
	End
	
	MaxSimultaneousOfType		= 1

	Behavior = SquishCollide ModuleTag_06
		;nothing
	End
	
	Geometry			= CYLINDER
	GeometryMajorRadius = 10.0
	GeometryHeight		= 30.0
	GeometryIsSmall		= No
	
	Shadow				= SHADOW_VOLUME
	  Shadow = SHADOW_DECAL
	  ShadowSizeX = 55
	  ShadowSizeY = 30
	  ShadowOffsetX = -8
	  ShadowTexture = ShadowI

	

	Behavior = SlavedUpdate ModuleTag_Slave
		LeashRange		= 410
		GuardMaxRange		= 0
		GuardWanderRange	= 400.0
		AttackRange		= 400
		FadeTime		= 1000
		GuardPositionOffset	= X:90 Y:20 Z:2
		UseSlaverAsControlForEvaObjectSightedEvents = No ; It's not a creep
	End


	EvaEnemyObjectSightedEvent = BarrowWightsSighted				; Special event for goblins showing up. Helps distinguish the real enemies from random creeps
  	EvaEnemyObjectSightedAfterRespawnEvent = BarrowWightsSighted 	; Event to run after the Goblin Lair is respawned. WARNING: This INI field only works for "SlavedUpdate.UseSlaverAsControlForEvaObjectSightedEvents = Yes" units

End

ChildObject BarrowWight_SlavedPortal2 BarrowWight_SlavedPortal
	Behavior = SlavedUpdate ModuleTag_Slave
		LeashRange		= 410
		GuardMaxRange		= 0
		GuardWanderRange	= 100.0
		AttackRange		= 100
		FadeTime		= 5000
		GuardPositionOffset	= X:55 Y:0 Z:20
		UseSlaverAsControlForEvaObjectSightedEvents = No ; It's not a creep
	End

	LocomotorSet
		Locomotor = BarrowWightFlyingLocomotor
		Condition = SET_NORMAL
		Speed     = 60
	End
End