


;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;															;;
;;    CASTLE WALL PIECES FOR THE NEW WALL BUILD SYSTEM		;;
;;															;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

Object IsengardCastleWallSegment
  
	// *** ART Parameters ***  
  	SelectPortrait = BPIWall
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = IBWallN
		End
		
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				;AnimationName		=	 IBWallRamp2.IBWallRamp2
;				AnimationName		=	 GBWallN.GBWallN
;				AnimationMode		=	LOOP
;  			End
   			StateName = STATE_None
		End



		//------------ New Build Up States coming soon. 		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = IBWallN_A
			Texture	= IBFortress.tga IBFortress_snow.tga
		End
				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = IBWallN_A
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  DBWallN_A
				AnimationName     =  IBWallN_A.IBWallN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End

		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model	= IBWallN_A
			Texture	= IBFortress.tga IBFortress_U.tga
		End
		
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = IBWallN_A
			Texture	= IBFortress.tga IBFortress_snow.tga
		End
		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = IBWallN_A
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = DBWallN_A
				AnimationName     = IBWallN_A.IBWallN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		

		//--damaged building	  
		ModelConditionState  = DAMAGED
			Model         = IBWallN_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_WallDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = IBWallN_D2
		End
	    
	    AnimationState = REALLYDAMAGED
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallN_D2.IBWallN_D2
				AnimationMode		=	ONCE
  			End
		    EnteringStateFX	= FX_WallDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = IBWallN_D3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallN_D3.IBWallN_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE WallDestructionDust
		End

		ModelConditionState  = RUBBLE
			Model         = None	;GBWall_Rubble  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = None	;GBWall_Rubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		AnimationState = POST_COLLAPSE
		End 

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model	= IBWallN
			Texture	= IBFortress.tga IBFortress_U.tga
		End
		ModelConditionState = SNOW  
			Model = IBWallN
			Texture	= IBFortress.tga IBFortress_snow.tga
		End	 
				
	End

	Draw = W3DScriptedModelDraw ModuleTag_Draw_Rubble
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = None
		End
	
		ModelConditionState  = COLLAPSING
			Model         = GBWall_Rubble
		End
		
		ModelConditionState  = RUBBLE
			Model         = GBWall_Rubble
		End
	    
		ModelConditionState  = POST_RUBBLE
			Model         = GBWall_Rubble
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
	End
	   
	// ***DESIGN parameters ***
	DisplayName         = OBJECT:IsengardCastleWallSegment
	Side                = Isengard
	EditorSorting       = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost           = ISENGARD_CASTLE_WALLSEGMENT_BUILDCOST
	BuildTime           = ISENGARD_CASTLE_WALLSEGMENT_BUILDTIME
	VisionRange         = 160.0          // Shroud clearing distance
	ShroudClearingRange = 160
	CommandSet			= IsengardWallUpgradeNodeCommandSet

	// *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= Gui_PlotSelect2
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= WallConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	// *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE WALL_SEGMENT SCALEABLE_WALL MADE_OF_STONE
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
	 
	//This is important to let the user select the rubble to begin self repair
	KeepSelectableWhenDead	= Yes
 
	Behavior            = GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		UseSpawnTimerWithoutWorker 		= Yes
		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		RebuildTimeSeconds			= ISENGARD_CASTLE_WALLSEGMENT_BUILDTIME
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= ISENGARD_CASTLE_WALLSEGMENT_HEALTH
		MaxHealthDamaged		= ISENGARD_CASTLE_WALLSEGMENT_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ISENGARD_CASTLE_WALLSEGMENT_HEALTH_REALLY_DAMAGED
	End
 
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay = 5000
	End												
	// These should always appear together on wall segments

	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Hub
		ReplaceWith = IsengardCastleWallHub
		TriggeredBy = Upgrade_IsengardWallHub
		ConflictsWith = Upgrade_IsengardWallRegularGate
	End
		
	Behavior = ReplaceSelfUpgrade ModuleTag_Replace_With_Gate
		ReplaceWith = IsengardCastleWallGate
		TriggeredBy = Upgrade_IsengardWallRegularGate
		ConflictsWith = Upgrade_IsengardWallHub
	End

	Behavior = ProductionUpdate ModuleTag_RequiredForUpgradeProduction
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_IsengardFortressIronPlating
		ObjectFilter = ANY +IsengardFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_IsengardFortressIronPlating
		AttributeModifier		= IronPlatingExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy			= Upgrade_IsengardFortressIronPlating		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	
	ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End

	;//	Geometry for the temp men small wall segment
	Geometry              = BOX
	GeometryMajorRadius   = 5.0		;10.0 
	GeometryMinorRadius   = 18.0	;20
	GeometryHeight        = 40.0	;47
	GeometryIsSmall       = No
	  
	;Geometry              = BOX
	;GeometryMajorRadius   = 25.0
	;GeometryMinorRadius   = 20.0
	;GeometryHeight        = 50
	;GeometryIsSmall       = No
  
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End

;---------------------------------------------
Object IsengardCastleWallHub
  
  ; *** ART Parameters ***
  
  	SelectPortrait = BPIWall_WallHub
  
	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = IBWallRmprtN
		End
		
		IdleAnimationState
;			Flags = ADJUST_HEIGHT_BY_CONSTRUCTION_PERCENT
;			Animation				=	ReallyDamagedanimation
;				;AnimationName		=	 IBWallRmprt.IBWallRmprt
;				AnimationName		=	 GBWallRmprtN.GBWallRmprtN
;				AnimationMode		=	LOOP
; 			End
   			StateName = STATE_None
		End



		;------------ New Build Up States coming soon. 
		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = IBWallRmprtN_A
			Texture	= IBFortress.tga IBFortress_snow.tga
		End
				
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = IBWallRmprtN_A
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  DBWallN_A
				AnimationName     =  IBWallRmprtN_A.IBWallRmprtN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model	= IBWallRmprtN_A
			Texture	= IBFortress.tga IBFortress_U.tga
		End

		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = IBWallRmprtN_A
			Texture	= IBFortress.tga IBFortress_snow.tga
		End
		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = IBWallRmprtN_A
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = IBWallRmprtN_A
				AnimationName     = IBWallRmprtN_A.IBWallRmprtN_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
			BeginScript
				CurDrawablePlaySound("GondorBarracksBeginConstruction")
			EndScript
		End
		

		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = IBWallRmprtN_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX	= FX_HubDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = IBWallRmprtN_D2
		End
	    
	    AnimationState = REALLYDAMAGED
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallRmprtN_D2.IBWallRmprtN_D2
				AnimationMode		=	ONCE
  			End
		    EnteringStateFX	= FX_HubDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = IBWallRmprtN_D3
		End
		
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallRmprtN_D3.IBWallRmprtN_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE HubDestructionDust
  			EnteringStateFX	= FX_StructureMediumCollapse
		End


		ModelConditionState  = DYING
			Model         = IBWallRmprtN_D3
		End
		
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallRmprtN_D3.IBWallRmprtN_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE HubDestructionDust
  			EnteringStateFX	= FX_StructureMediumCollapse
		End



		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
		End
		AnimationState = POST_COLLAPSE
		End 

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model	= IBWallRmprtN
			Texture	= IBFortress.tga IBFortress_U.tga
		End

		ModelConditionState = SNOW  
			Model = IBWallRmprtN
			Texture	= IBFortress.tga IBFortress_snow.tga
		End	 

	End
 
	; ***DESIGN parameters ***
	RadarPriority       = STRUCTURE	
	DisplayName         = OBJECT:IsengardCastleWallHub
	Side                = Isengard
	EditorSorting       = STRUCTURE
	ThreatLevel = 1.0
	 
	BuildCost           = ISENGARD_CASTLE_WALLHUB_BUILDCOST
	BuildTime           = ISENGARD_CASTLE_WALLHUB_BUILDTIME
	VisionRange         = 160.0          ; Shroud clearing distance
	ShroudClearingRange = 160



	CommandSet = IsengardCastleWallHubCommandSet
	

	; *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

    VoiceSelect						= NeutralWallHubSelect	;Gui_PlotSelect2
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

	SoundOnDamaged					= BuildingLightDamageStone
	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:COLLAPSING	 Sound:BuildingSink
	End

	CampnessValue = CAMPNESS_WALL

	; *** ENGINEERING Parameters ***
	RadarPriority       = STRUCTURE
	KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_HUB MADE_OF_STONE WALL_UPGRADE
	ThreatBreakdown ThreatBreakdown_ModuleTag
		AIKindOf = WALL
	End
	 
	Behavior            = GettingBuiltBehavior ModuleTag_04
		UseSpawnTimerWithoutWorker 		= Yes
   		SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
		;SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = WallConstructionLoop
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
	End

	Body                = StructureBody ModuleTag_05
		MaxHealth				= ISENGARD_CASTLE_WALLHUB_HEALTH
		MaxHealthDamaged		= ISENGARD_CASTLE_WALLHUB_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ISENGARD_CASTLE_WALLHUB_HEALTH_REALLY_DAMAGED
	End
 

	Behavior				= SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay	= 5000
		;Sound				= INITIAL BuildingSink
	End
	
	Behavior = WallHubBehavior ModuleTag_WALL_HUB

		Options = OPTION_ONE
		MaxBuildoutDistance = 760		;MEN_FORTRESS_WALL_EFFECTIVE_RADIUS
		StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR

		;;This defines the pattern built on flat terrain
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallSegment
		SegmentTemplateName = IsengardCastleWallHub
		
		BuilderRadius = 20
		
		HubCapTemplateName = IsengardCastleWallHub
		DefaultSegmentTemplateName = IsengardCastleWallSegment

		CliffCapTemplateName = IsengardWallCliffCap		
		;ShoreCapTemplateName = [NAME]		
		;BorderCapTemplateName = [NAME]		
		;ElevatedSegmentTemplateName = [NAME]

	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius			= 60		;// How far we try to claim ground
		MaxIncome		= 0			;// If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval	= 999999	;// How often (in msec) we give that much money
		HighPriority	= Yes		;// A high priority claim gets to pretend it was there first.
		Visible = No 		;// Don't show decal when a resource building is selected.
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_IsengardFortressIronPlating
		ObjectFilter = ANY +IsengardFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_IsengardFortressIronPlating
		AttributeModifier		= IronPlatingExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy			= Upgrade_IsengardFortressIronPlating		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End	
	
	ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End

	;//	Geometry for the temp small men wall hub
	Geometry              = CYLINDER
	GeometryMajorRadius   = 20.0 ; 
	GeometryMinorRadius   = 20.0 ; 
	GeometryHeight        = 70.0
	GeometryIsSmall       = No

	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 5.0		;10.0 
	GeometryMinorRadius   = 20.0
	GeometryHeight        = 40.0	;47
	GeometryIsSmall       = No
	
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
	
	GeometryContactPoint = X:-21		Y:22		Z:0			Repair
	GeometryContactPoint = X:23		Y:-20		Z:0			Repair
	GeometryContactPoint = X:5.576		Y:44.987	Z:0
	GeometryContactPoint = X:-38.348	Y:-42.113	Z:0
	GeometryContactPoint = X:-28.448	Y:-0.003	Z:75.14		Swoop
End


;---------------------------------------------------------
Object IsengardCastleWallGate
   
   ; *** ART Parameters ***
   
   	SelectPortrait = BPIWall_MainGate
   
 	Draw = W3DScriptedModelDraw ModuleTag_Draw
 		OkToChangeModelColor  = Yes
 		UseStandardModelNames = Yes
 		DefaultModelConditionState
 			Model = IBWallGateN_SKN
 		End


;--------- damage states for the gate

		ModelConditionState   = DAMAGED
			Model               = IBWallGateN_D1
		End
		
		ModelConditionState   = REALLYDAMAGED
			Model               = IBWallGateN_D2
		End

		ModelConditionState  = COLLAPSING DOOR_1_OPENING
			Model         = IBWallGateN_D4
		End
		AnimationState = COLLAPSING DOOR_1_OPENING
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallGateN_D4.IBWallGateN_D4
				AnimationMode		=	ONCE
  			End
		End
		
		ModelConditionState  = COLLAPSING
			Model         = IBWallGateN_D3
		End
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallGateN_D3.IBWallGateN_D3
				AnimationMode		=	ONCE
  			End
		End

		ModelConditionState  = DYING
			Model         = IBWallGateN_D3
		End
		AnimationState = DYING
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallGateN_D3.IBWallGateN_D3
				AnimationMode		=	ONCE
  			End
  			EnteringStateFX	= FX_StructureMediumCollapse
  			ParticleSysBone NONE HubDestructionDust

		End


		ModelConditionState  = RUBBLE
			Model         = None  
		End  
		
		ModelConditionState  = POST_RUBBLE
			Model         = NONE
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
		Model         = None
			ParticleSysBone NONE SmokeBuildingMediumRubble
		End
		AnimationState = POST_COLLAPSE
		End 

				
;------ Door Animations
		
		AnimationState = DOOR_1_OPENING 
			Flags = START_FRAME_LAST
			StateName = Door_Open
			Animation				=	Death
				AnimationName		=	IBWallGateN_SKL.IBWallGateN_OP
				AnimationMode		=	ONCE
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Door_Close" then CurDrawableSetTransitionAnimState("TRANS_Closed_To_Open") end
			EndScript
		End
		TransitionState = TRANS_Closed_To_Open
			Animation = Open 
				AnimationName	=	IBWallGateN_SKL.IBWallGateN_OPN
				AnimationMode	=	ONCE 
			End
		End
    
		AnimationState = DOOR_1_CLOSING 
			Flags = START_FRAME_LAST
			StateName = Door_Close
			Animation				=	Death
				AnimationName		=	IBWallGateN_SKL.IBWallGateN_CL
				AnimationMode		=	ONCE
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "Door_Open" then CurDrawableSetTransitionAnimState("TRANS_Open_To_Closed") end
			EndScript
		End
		TransitionState = TRANS_Open_To_Closed
			Animation = Open 
				AnimationName	=	IBWallGateN_SKL.IBWallGateN_CLS
				AnimationMode	=	ONCE 
			End
		End
		
		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model	= IBWallGateN_SKN
			Texture	= IBFortress.tga IBFortress_U.tga
		End

		ModelConditionState = SNOW
			Model = IBWallGateN_SKN
			Texture	= IBFortress.tga IBFortress_snow.tga
		End
		
 	End
      
   ; ***DESIGN parameters ***
   DisplayName         = OBJECT:IsengardCastleWallGate
   Side                = Isengard
   EditorSorting       = STRUCTURE
   ThreatLevel = 1.0
  
   BuildCost           = ISENGARD_CASTLE_WALLGATE_BUILDCOST
   BuildTime           = ISENGARD_CASTLE_WALLGATE_BUILDTIME
   VisionRange         = 160.0          ; Shroud clearing distance
   ShroudClearingRange = 160
   
   CommandSet			= CastleGateCommandSet
 
   ; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= GateSelect
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

 	SoundOnDamaged					= BuildingLightDamageStone
 	SoundOnReallyDamaged			= BuildingHeavyDamageStone

    UnitSpecificSounds
        UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	;ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
	;	ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	;End

	CampnessValue = CAMPNESS_WALL

   ; *** ENGINEERING Parameters ***
   RadarPriority       = STRUCTURE
   KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE WALL_UPGRADE MADE_OF_STONE BLOCKING_GATE WALL_GATE
  
	Behavior            = GettingBuiltBehavior ModuleTag_04
		SelfBuildingLoop			= WallConstructionLoop			// Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound						// This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= WallConstructionLoop
		SpawnTimer					= -1.0							// Negative means no 'autoheal'
		RebuildTimeSeconds			= ISENGARD_CASTLE_WALLGATE_BUILDTIME
	End
 
	Body                = StructureBody ModuleTag_05
		MaxHealth				= ISENGARD_CASTLE_WALLGATE_HEALTH
		MaxHealthDamaged		= ISENGARD_CASTLE_WALLGATE_HEALTH_DAMAGED
		MaxHealthReallyDamaged	= ISENGARD_CASTLE_WALLGATE_HEALTH_REALLY_DAMAGED
	End
  
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= ALL
		DestructionDelay = 5000 
	End												
	
	Behavior = GateOpenAndCloseBehavior ModuleTag_GATE
		ResetTimeInMilliseconds			= 3000				;important! this must be longer than the gates animation, ir it will twitch
		OpenByDefault					= No
		PercentOpenForPathing			= 50
		SoundOpeningGateLoop			= GateOpenStart
		SoundClosingGateLoop			= GateCloseStart
		SoundFinishedOpeningGate		= GateOpenEnd
		SoundFinishedClosingGate		= GateCloseEnd
		TimeBeforePlayingOpenSound		= 9500
		TimeBeforePlayingClosedSound	= 9500
	End
	
	Behavior = FakePathfindPortalBehaviour ModuleTag_FAKEPATHFIND
		AllowEnemies			= No
		AllowNonSkirmishAIUnits	= No
	End
	
	Behavior = AIGateUpdate ModuleTage_AIGateUpdate
		TriggerWidthX = 300.0
		TriggerWidthY = 150.0
	End

	Behavior = InheritUpgradeCreate ModuleTag_InheritStonework
		Radius = ISENGARD_FORTRESS_WALL_EFFECTIVE_RADIUS
		Upgrade = Upgrade_IsengardFortressIronPlating
		ObjectFilter = ANY +IsengardFortressCitadel
	End

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_IsengardFortressIronPlating
		AttributeModifier		= IronPlatingExpansion_Bonus		
	End

	Behavior = ModelConditionUpgrade ModuleTag_ShowThePlating
		TriggeredBy			= Upgrade_IsengardFortressIronPlating		
		AddConditionFlags	= UPGRADE_NUMENOR_STONEWORK
		Permanent			= Yes
	End
	
	ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End
	
	;//	Geometry from small men wall gate
	GeometryIsSmall		  = No

	; right pillar
	Geometry              = BOX
	GeometryMajorRadius   = 10.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 75
	GeometryOffset        = X:0 Y:50 Z:0
	
	; left pillar
	AdditionalGeometry    = BOX
	GeometryMajorRadius   = 10.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 75
	GeometryOffset        = X:0 Y:-50 Z:0

	; Main
	AdditionalGeometry    = BOX
	GeometryName		  = "Closed"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 50.0  
	GeometryHeight        = 50
	
	; Left open
	AdditionalGeometry    = BOX
	GeometryName		  = "OpenLeft"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 40
	GeometryOffset        = X:0 Y:-30 Z:0
	
	; Right open
	AdditionalGeometry    = BOX
	GeometryName		  = "OpenRight"
	GeometryMajorRadius   = 9.0  
	GeometryMinorRadius   = 10.0  
	GeometryHeight        = 40
	GeometryOffset        = X:0 Y:30 Z:0
	
	// need some geometry points to tell enemy weapons where to hit.
	GeometryContactPoint = X:0	Y:50 Z:75
	GeometryContactPoint = X:0	Y:50 Z:10
	GeometryContactPoint = X:0	Y:-50 Z:10
	GeometryContactPoint = X:0	Y:-50 Z:75
	
 
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
End
   
   
;----------------------------------------------------------------------
   
Object IsengardWallCliffCap

	SelectPortrait  =  BPIWall
  
  ; *** ART Parameters ***
	
   	Draw = W3DScriptedModelDraw ModuleTag_Draw
		OkToChangeModelColor  = Yes
		UseStandardModelNames = Yes
		DefaultModelConditionState
			Model = IBWallNE
		End
		
		IdleAnimationState
   			StateName = STATE_None
		End



		//------------ New Build Up States coming soon. 		
		ModelConditionState = SNOW AWAITING_CONSTRUCTION
			Model = IBWallNE_A
			Texture	= IBFortress.tga IBFortress_snow.tga
		End
		ModelConditionState   = AWAITING_CONSTRUCTION 
			Model               = IBWallNE_A
		End
		AnimationState        = AWAITING_CONSTRUCTION
			Animation           =  IBWallNE_A
				AnimationName     =  IBWallNE_A.IBWallNE_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
		End

		ModelConditionState	= UPGRADE_NUMENOR_STONEWORK ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model	= IBWallNE_A
			Texture	= IBFortress.tga IBFortress_U.tga
		End
		
		ModelConditionState = SNOW ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model = IBWallNE_A
			Texture	= IBFortress.tga IBFortress_snow.tga
		End
		
		ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Model               = IBWallNE_A
		End
	    
		AnimationState        = ACTIVELY_BEING_CONSTRUCTED PARTIALLY_CONSTRUCTED
			Animation           = IBWallNE_A
				AnimationName     = IBWallNE_A.IBWallNE_A
				AnimationMode     = MANUAL
				AnimationBlendTime = 0
			End
			Flags				  = START_FRAME_FIRST
			StateName			  = BeingConstructed
			ParticleSysBone   = NONE WallConstructDust FollowBone:Yes
		End
		

		;--damaged building
	  
		ModelConditionState  = DAMAGED
			Model         = IBWallNE_D1
		End
		
		AnimationState = DAMAGED
			EnteringStateFX	= FX_WallDamaged
		End	    
		
		ModelConditionState  = REALLYDAMAGED
			Model         = IBWallNE_D2
		End
	    AnimationState = REALLYDAMAGED
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallNE_D2.IBWallNE_D2
				AnimationMode		=	ONCE
  			End
		    EnteringStateFX	= FX_WallDamaged
		End
 
		ModelConditionState  = COLLAPSING
			Model         = IBWallNE_D3
		End
		AnimationState = COLLAPSING
      		Animation				=	RubbleAnimation
				AnimationName		=	 IBWallNE_D3.IBWallNE_D3
				AnimationMode		=	ONCE
  			End
  			ParticleSysBone NONE WallDestructionDust
			EnteringStateFX			= FX_StructureMediumCollapse
		End

		ModelConditionState  = RUBBLE
			Model         = None	;GBWall_Rubble  
		End  
		AnimationState = RUBBLE
		End
		
		ModelConditionState  = POST_RUBBLE
			Model         = None	;GBWall_Rubble
		End
		AnimationState = POST_RUBBLE
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		AnimationState = POST_COLLAPSE
		End 
		

		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
			Model	= IBWallNE
			Texture	= IBFortress.tga IBFortress_U.tga
		End
		ModelConditionState = SNOW  
			Model = IBWallNE
			Texture	= IBFortress.tga IBFortress_snow.tga
		End	 
				
	End
	
;    Draw = W3DFloorDraw ModuleTag_DrawFloor    
;;    		StaticModelLODMode = yes ; Will append M or L to the skin name depending on GameLOD
;  		ModelName = GBWallN_Bib
;	End
  
  ; ***DESIGN parameters ***
  DisplayName         = OBJECT:IsengardWallCliffCap
  Side                = Isengard
  EditorSorting       = STRUCTURE
  ThreatLevel = 1.0
 
 
	CommandSet			= IsengardWallCliffCapCommandSet

 
  BuildCost           = MEN_WALLSEGMENT_SMALL_BUILDCOST
  BuildTime           = MEN_WALLSEGMENT_SMALL_BUILDTIME
  VisionRange         = MEN_WALLSEGMENT_SMALL_VISION_RANGE
  ShroudClearingRange = MEN_WALLSEGMENT_SMALL_SHROUD_CLEAR

  ; *** AUDIO Parameters ***
	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
	SoundOnDamaged		= BuildingLightDamageStone
	SoundOnReallyDamaged	= BuildingHeavyDamageStone
    VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

    UnitSpecificSounds
        UnderConstruction		= WallConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= WallConstructionLoop	; Repaired from completely destroyed (not used???)
    End

	;ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
	;	ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
	;End

	CampnessValue = CAMPNESS_WALL

  ; *** ENGINEERING Parameters ***
  RadarPriority       = STRUCTURE
  KindOf              = PRELOAD STRUCTURE SELECTABLE IMMOBILE SCORE DEFENSIVE_WALL MADE_OF_STONE CAN_CAST_REFLECTIONS
   ThreatBreakdown ThreatBreakdown_ModuleTag
	AIKindOf = WALL
   End
 
  Behavior            = GettingBuiltBehavior ModuleTag_04
	UseSpawnTimerWithoutWorker 		= Yes
   	SpawnTimer	= DEFAULT_STRUCTURE_HEALDELAY
	SelfBuildingLoop = WallConstructionLoop ; Only played if we DON'T spawn a worker
	SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
	SelfRepairFromRubbleLoop  = WallConstructionLoop
  End

  Body                = StructureBody ModuleTag_05
    MaxHealth         = MEN_WALLSEGMENT_SMALL_HEALTH
  End
 
;  Behavior            = DestroyDie ModuleTag_07
;    ;nothing
;  End
	
	// These should always appear together on wall segments
	Behavior = KeepObjectDie ModuleTag_IWantRubble 
		DeathTypes			= ALL -SUICIDED
	End
	Behavior            = SlowDeathBehavior ModuleTag_SlowDeath
		DeathTypes			= NONE +SUICIDED
		DestructionDelay = 5000
	End	
	  
  ArmorSet
		Conditions        = None
		Armor             = IsenWallArmor
		DamageFX          = None
	End


	Geometry              	= BOX
	GeometryMajorRadius   	= 10.0 
	GeometryMinorRadius   	= 40.0   
	GeometryHeight			= 80
	GeometryIsSmall			= No
	GeometryOffset			= X:0 Y:-20 Z:-40
  
  Shadow                = SHADOW_VOLUME
  BuildCompletion     = PLACED_BY_PLAYER
End


ChildObject IsengardCastleWallSegment_EM IsengardCastleWallSegment

	CommandSet = EvilModCastleWallCommandSet
	
	Scale = 1.2

	Geometry              = BOX
	GeometryMajorRadius   = 10 
	GeometryMinorRadius   = 20.0	
	GeometryHeight        = 48
	GeometryIsSmall       = No
	GeometryOffset			= X:0 Y:0 Z:0
	;GeometryRotationAnchorOffset = X:-375 Y:0
	  
	Shadow                = SHADOW_VOLUME
	BuildCompletion     = PLACED_BY_PLAYER
		

End


ChildObject IsengardCastleWallHub_EM IsengardCastleWallHub
	
	
	CommandSet = EmptyCommandSet

	Behavior = WallHubBehavior ModuleTag_WALL_HUB

		Options = OPTION_ONE
		MaxBuildoutDistance = 1000
		StaggeredBuildFactor = STANDARD_WALL_STAGGERED_BUILD_FACTOR

		;;This defines the pattern built on flat terrain
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallSegment_EM
		SegmentTemplateName = IsengardCastleWallHub_EM
		
		BuilderRadius = 30
		
		HubCapTemplateName = IsengardCastleWallHub_EM
		DefaultSegmentTemplateName = IsengardCastleWallSegment_EM

		CliffCapTemplateName = IsengardWallCliffCap		
		;ShoreCapTemplateName = [NAME]		
		;BorderCapTemplateName = [NAME]		
		;ElevatedSegmentTemplateName = [NAME]

	End



	Scale = 1.2

	Geometry              = CYLINDER
	GeometryMajorRadius   = 20.0 ; 
	GeometryMinorRadius   = 20.0 ; 
	GeometryHeight        = 84.0
	GeometryIsSmall       = No

	AdditionalGeometry    = BOX
	GeometryIsSmall       = No
	GeometryMajorRadius   = 5.0		;10.0 
	GeometryMinorRadius   = 20.0
	GeometryHeight        = 48.0	;47
	GeometryIsSmall       = No

End


//REAL CASTLE


;----------------------------------------------------------------------------------------------
;
; FILE: GondorBuildings.ini
;
;----------------------------------------------------------------------------------------------

Object IsengardCastleGate1_EM

	SelectPortrait  =  BPCIsengardGate

	Draw = W3DScriptedModelDraw ModuleTag_DRAW
		WallBoundsMesh = P1   
		//RampMesh1 = P2 
		//RaisedWallMesh = P3  

		DefaultModelConditionState
			Model = IBGATE1
		End
		
		ModelConditionState  = DAMAGED
			Model         = IBGATE1_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX = FX_MinWallATransitionDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = IBGATE1_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	IBGATE1_D2.IBGATE1_D2
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
   			End
			EnteringStateFX = FX_MinWallATransitionReallyDamaged
		End

		ModelConditionState  = RUBBLE
			Model         = IBGATE1_D3
		End
		AnimationState = RUBBLE
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	IBGATE1_D3.IBGATE1_D3
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
   			End
			EnteringStateFX = FX_MinWallATransitionRubble
		End
		
	End; 


	; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone


	; ***DESIGN parameters ***

	DisplayName		= OBJECT:IsengardCastleGate
	EditorSorting	= STRUCTURE
	Side			= Isengard

	ArmorSet
		Conditions	= None
		Armor		= StructureArmor
		DamageFX	= None
	End
	
	; *** ENGINEERING Parameters ***  
	KindOf				= STRUCTURE SELECTABLE IMMOBILE WALK_ON_TOP_OF_WALL NOT_AUTOACQUIRABLE IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP DONT_HIDE_IF_FOGGED
	RadarPriority		= NOT_ON_RADAR
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= 5000.0
	End

	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End

  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End

	Scale = 0.75	

  Geometry              = BOX
  GeometryMajorRadius   = 30	//62.5
  GeometryMinorRadius   = 40.0 //50	//70
  GeometryHeight        = 60.0
  GeometryOffset		= X:13 Y:-130 Z:0
    
  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 20.0	//20
  GeometryMinorRadius   = 40.0 //65
  GeometryHeight        = 18.0	
  GeometryOffset		= X:10 Y:-35 Z:60
 
 
   	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 25.0
	GeometryMinorRadius				= 10.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:50 Y: -75 Z:0
	GeometryName					= Bookend

  	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 10.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-8 Y:-125 Z:0
	GeometryName					= Bookend

	GeometryContactPoint			= X:90		Y: -90		Z:0 
	GeometryContactPoint			= X:50		Y: -70		Z:0 
	GeometryContactPoint			= X:70		Y: -130		Z:45 
	GeometryContactPoint			= X:70		Y: -130		Z:0 
	GeometryContactPoint			= X:100		Y: -130		Z:0 
	GeometryContactPoint			= X:30		Y: -130		Z:0 
	GeometryContactPoint			= X:25		Y: -200		Z:0  
	GeometryContactPoint			= X:50		Y: -200		Z:0  
	GeometryContactPoint			= X:-60		Y: -170		Z:0 
 
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End



;----------------------------------------------------------------------------------------------
Object IsengardCastleGate2_EM

	SelectPortrait  =  BPCIsengardGate

	Draw = W3DScriptedModelDraw ModuleTag_DRAW
		WallBoundsMesh = P1   
		//RampMesh1 = P2 
		//RaisedWallMesh = P3  

		DefaultModelConditionState
			Model = IBGATE2
		End
		
		ModelConditionState  = DAMAGED
			Model         = IBGATE2_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX = FX_MinWallATransitionDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = IBGATE2_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	IBGATE2_D2.IBGATE2_D2
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
   			End
			EnteringStateFX = FX_MinWallATransitionReallyDamaged
		End

		ModelConditionState  = RUBBLE
			Model         = IBGATE2_D3
		End
		AnimationState = RUBBLE
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	IBGATE2_D3.IBGATE2_D3
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
   			End
			EnteringStateFX = FX_MinWallATransitionRubble
		End
		
	End; 


	; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:IsengardCastleGate
	EditorSorting	= STRUCTURE
	Side			= Civilian

	ArmorSet
		Conditions	= None
		Armor		= StructureArmor
		DamageFX	= None
	End
	
	; *** ENGINEERING Parameters ***  
	KindOf				= STRUCTURE SELECTABLE IMMOBILE WALK_ON_TOP_OF_WALL NOT_AUTOACQUIRABLE IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP DONT_HIDE_IF_FOGGED
	RadarPriority		= NOT_ON_RADAR
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= 5000.0
	End

	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End
	
  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	Scale = 0.75

  Geometry              = BOX
  GeometryMajorRadius   = 30 	//62.5
  GeometryMinorRadius   = 40.0 //50	//70
  GeometryHeight        = 60.0
  GeometryOffset		= X:13 Y:130 Z:0
    
  AdditionalGeometry    = BOX
  GeometryMajorRadius   = 20.0	//40
  GeometryMinorRadius   = 40.0 //65
  GeometryHeight        = 18.0	
  GeometryOffset		= X:10 Y:35 Z:60
  
  
  	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 25.0
	GeometryMinorRadius				= 10.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:50 Y: 75 Z:0
	GeometryName					= Bookend

  	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 10.0
	GeometryMinorRadius				= 30.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-8 Y:125 Z:0
	GeometryName					= Bookend
  
	GeometryIsSmall					= No
	
	GeometryContactPoint			= X:90		Y: 90		Z:0 
	GeometryContactPoint			= X:50		Y: 70		Z:0 
	GeometryContactPoint			= X:70		Y: 130		Z:45 
	GeometryContactPoint			= X:70		Y: 130		Z:0 
	GeometryContactPoint			= X:100		Y: 130		Z:0 
	GeometryContactPoint			= X:30		Y: 130		Z:0 
	GeometryContactPoint			= X:25		Y: 200		Z:0  
	GeometryContactPoint			= X:50		Y: 200		Z:0  
	GeometryContactPoint			= X:-60		Y: 170		Z:0 

	
	Shadow							= SHADOW_VOLUME
End


;----------------------------------------------------------------------------------------------
Object IsengardCastleWallA_EM

	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_DRAW
	    RampMesh1		= P1
	    WallBoundsMesh	= P2
		ExtraPublicBone	= SiegeTower01
		ExtraPublicBone	= SiegeTower02

		DefaultModelConditionState
			Model = IBWALLA
		End
		
		ModelConditionState  = DAMAGED
			Model         = IBWALLA_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX = FX_MinWallATransitionDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = IBWALLA_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	IBWALLA_D2.IBWALLA_D2
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
   			End
			EnteringStateFX = FX_MinWallATransitionReallyDamaged
		End

		ModelConditionState  = RUBBLE
			Model         = IBWALLA_D3
		End
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	IBWALLA_D3.IBWALLA_D3
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
			End
			EnteringStateFX = FX_MinWallATransitionRubble
		End      

	End; 

	
	; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:IsengardCastleWall
	EditorSorting	= STRUCTURE
	Side			= Civilian

	ArmorSet
		Conditions	= None
		Armor		= StructureArmor
		DamageFX	= None
	End

	Scale = 0.75

	; *** ENGINEERING Parameters ***  
	KindOf				= STRUCTURE SELECTABLE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR NOT_AUTOACQUIRABLE IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP DONT_HIDE_IF_FOGGED		;;;should this get autoacquired, or not?
	RadarPriority		= NOT_ON_RADAR
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= 5000.0
	End
	
	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End
    	
	Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
	End
	
	Behavior                = TransitionDamageFX ModuleTag_TransDamageFX
	;	RubbleNeighbor NeighborOffset: X:0 Y:-200 Z:0 SubObject:BookendLeft SubObject:BookendLeftA OCL:OCL_MinWallA_BOOKEND_Right 
	;	RubbleNeighbor NeighborOffset: X:0 Y: 200 Z:0 SubObject:BookendRight SubObject:BookendRightA OCL:OCL_MinWallA_BOOKEND_Left 

;		DamagedFXList1 = loc: X:0 Y:0 Z:0 fxlist:FX_MinWallATransitionDamaged
	End

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 20.0 	//25	 //35
	GeometryMinorRadius				= 70.0	//90	 //120
	GeometryHeight					= 50.0
	GeometryOffset					= X:7.7 Y:0.0 Z:0.0
	//GeometryRotationAnchorOffset 	= X:770.146 Y:0.0 

	AdditionalGeometry    			= BOX
 	GeometryMajorRadius  			= 6.0
 	GeometryMinorRadius  			= 50.0 //70
 	GeometryHeight       			= 50.0	
	GeometryOffset					= X:52.0 Y:0.0 Z:0.0
	//GeometryRotationAnchorOffset 	= X:770.146 Y:0.0
	
	AdditionalGeometry    			= BOX
 	GeometryMajorRadius  			= 14.0
 	GeometryMinorRadius  			= 5.0
 	GeometryHeight       			= 52.0	
	GeometryOffset					= X:81.0 Y:0.0 Z:0.0
	//GeometryRotationAnchorOffset 	= X:770.146 Y:0.0	
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:0 Y: 100 Z:0
	GeometryName					= Bookend
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:0 Y:-100 Z:0
	GeometryName					= Bookend
	
	GeometryContactPoint			= X:65	Y:65	Z:0		Grab
	GeometryContactPoint			= X:65	Y:-65	Z:0		Grab
	GeometryContactPoint			= X:-40	Y:50	Z:0		Grab
	GeometryContactPoint			= X:-40	Y:-50	Z:0		Grab

	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
End

;----------------------------------------------------------------------------------------------
Object IsengardCastleWallB_EM

	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_DRAW
	    WallBoundsMesh	= P1
		ExtraPublicBone	= SiegeTower01
		ExtraPublicBone	= SiegeTower02

		DefaultModelConditionState
			Model = IBWALLB
		End
		
		ModelConditionState  = DAMAGED
			Model         = IBWALLB_D1  
		End
		AnimationState = DAMAGED
			EnteringStateFX = FX_MinWallATransitionDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = IBWALLB_D2
		End
		AnimationState = REALLYDAMAGED
       		Animation				=	ReallyDamagedanimation
				AnimationName		=	IBWALLB_D2.IBWALLB_D2
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
   			End
			EnteringStateFX = FX_MinWallATransitionReallyDamaged
		End

		ModelConditionState  = RUBBLE
			Model         = IBWALLB_D3
		End
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	IBWALLB_D3.IBWALLB_D3
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange = 0.5 0.5
			End
			EnteringStateFX = FX_MinWallATransitionRubble
		End      

	End; 
	
	
	; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:IsengardCastleWall
	EditorSorting	= STRUCTURE
	Side			= Isengard

	ArmorSet
		Conditions	= None
		Armor		= StructureArmor
		DamageFX	= None
	End

	; *** ENGINEERING Parameters ***  
	KindOf				= STRUCTURE SELECTABLE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR NOT_AUTOACQUIRABLE IGNORE_FOR_VICTORY NEVER_CULL_FOR_MP DONT_HIDE_IF_FOGGED		;;;should this get autoacquired, or not?
	RadarPriority		= NOT_ON_RADAR
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= 5000.0
	End

	Scale = 0.75
	
	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End

	//Allow siege docking.
	Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
	End
	
	Behavior                = TransitionDamageFX ModuleTag_TransDamageFX
	;	RubbleNeighbor NeighborOffset: X:0 Y:-200 Z:0 SubObject:BookendLeft SubObject:BookendLeftA OCL:OCL_MinWallA_BOOKEND_Right 
	;	RubbleNeighbor NeighborOffset: X:0 Y: 200 Z:0 SubObject:BookendRight SubObject:BookendRightA OCL:OCL_MinWallA_BOOKEND_Left 

;		DamagedFXList1 = loc: X:0 Y:0 Z:0 fxlist:FX_MinWallATransitionDamaged
	End
	
 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 20.0 	//25	//35
	GeometryMinorRadius				= 70.0	//90	//120
	GeometryHeight					= 50.0
	GeometryOffset					= X:7.7 Y:0.0 Z:0.0
	//GeometryRotationAnchorOffset	= X:770.146 Y:0.0

	AdditionalGeometry    			= BOX
 	GeometryMajorRadius  			= 6.0
 	GeometryMinorRadius  			= 50.0 	//50	//70
 	GeometryHeight       			= 50.0	
	GeometryOffset					= X:52.0 Y:0.0 Z:0.0
	//GeometryRotationAnchorOffset 	= X:770.146 Y:0.0
		
	AdditionalGeometry    			= BOX
 	GeometryMajorRadius  			= 14.0
 	GeometryMinorRadius  			= 5.0
 	GeometryHeight       			= 52.0	
	GeometryOffset					= X:81.0 Y:0.0 Z:0.0
	//GeometryRotationAnchorOffset 	= X:770.146 Y:0.0
	
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:0 Y: 100 Z:0
	GeometryName					= Bookend
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:0 Y:-100 Z:0
	GeometryName					= Bookend
	
	
	GeometryIsSmall					= No
	Shadow							= SHADOW_VOLUME
	
	GeometryContactPoint			= X:65	Y:65	Z:0		Grab
	GeometryContactPoint			= X:65	Y:-65	Z:0		Grab
	GeometryContactPoint			= X:-40	Y:50	Z:0		Grab
	GeometryContactPoint			= X:-40	Y:-50	Z:0		Grab
End


   
//From gondor castle!  !


Object GondorCastleElevator_for_isen_EM //

  SelectPortrait = BPCastleWall
  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_01
		OkToChangeModelColor = Yes

	RandomTexture = iborctent2_bib_s.tga 0 gbcastewall.tga
	//RandomTexture = upwild_porter.tga 0 gbcastewall.tga

		ExtraPublicBone = Elev01
		ExtraPublicBone = Elev02
		ExtraPublicBone = Elev03
		ExtraPublicBone = Elev04
;		ExtraPublicBone = Elev05

	    WallBoundsMesh = P1

    DefaultModelConditionState
      Model = GBCASTELEV
    End

		ModelConditionState = WORLD_BUILDER
  			Model = GBCASTELEVW
  		End
  		
	IdleAnimationState
		Animation
			AnimationName     = GBCASTELEV.GBCASTELEV
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
        End
		StateName = STATE_None
        Flags = START_FRAME_LAST
	End    

    ;------------Build Up States
    ModelConditionState   = BASE_BUILD
      Model               = GBCASTELEV
;      ParticleSysBone	  = NONE BuildingDoughnutCloud
      ParticleSysBone     = NONE BuildingContructDust
    End  
	AnimationState		  = BASE_BUILD
		StateName = STATE_None
		Animation
			AnimationName = GBCASTELEV.GBCASTELEV
			AnimationMode = ONCE
			AnimationSpeedFactorRange = 2.0 2.5 ; keep range wide to avoid lockstep anims
		End
	End

	AnimationState		  = JUST_BUILT
		Animation
			AnimationName = GBCASTELEV.GBCASTELEV
			AnimationMode = MANUAL
			AnimationBlendTime = 0
		End
        Flags = START_FRAME_FIRST
		StateName = STATE_None
	End    

	; Explicit because of numenor upgrade.
	ModelConditionState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
		Model = GBCASTELEV_UA
	End
	AnimationState		  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
		Animation
			AnimationName = GBCASTELEV_UA.GBCASTELEV_UA
			AnimationMode = MANUAL
			AnimationBlendTime = 0
		End
		StateName = STATE_None
	    Flags = START_FRAME_FIRST
		;BeginScript
		;	CurDrawablePlaySound("GondorBarracksBeginConstruction")
		;EndScript
	End    

	ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
		Model = GBCASTELEV
	End
	AnimationState		  = ACTIVELY_BEING_CONSTRUCTED
		Animation
			AnimationName = GBCASTELEV.GBCASTELEV
			AnimationMode = MANUAL
			AnimationBlendTime = 0
		End
		StateName = STATE_None
        Flags = START_FRAME_FIRST
		;BeginScript
		;	CurDrawablePlaySound("GondorBarracksBeginConstruction")
		;EndScript
	End    
		
    ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCASTELEV_UD1
    End
    ModelConditionState  = DAMAGED
      Model         = GBCASTELEV_D1
    End
    
    AnimationState = DAMAGED
		StateName = STATE_None
;		EnteringStateFX = FX_MinWallATransitionDamaged
    End

	; REALLYDAMAGED ----------------------------------------------------------------------------------------------------------------
	TransitionState = TRANS_U_IntoReallyDamaged
		EnteringStateFX		= FX_BuildingReallyDamaged
		Animation = D2
			AnimationName		= GBCASTELEV_UD2.GBCASTELEV_UD2
			AnimationMode		= ONCE
			AnimationBlendTime	= 0
		End
	End
    ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCASTELEV_UD2
    End
	AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
 		StateName				= STATE_ReallyDamaged
 		Flags					= START_FRAME_LAST
      	Animation				= ReallyDamagedanimation_U
			AnimationName		= GBCASTELEV_UD2.GBCASTELEV_UD2
			AnimationMode		= MANUAL
			AnimationBlendTime = 0
   		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_None" or Prev == "STATE_Rubble"
			then
				; Only play the really damaged anim if we havn't come from another really damaged.
				CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
			end
		EndScript
    End

    ModelConditionState  = REALLYDAMAGED
      Model         = GBCASTELEV_D2
    End
	AnimationState = REALLYDAMAGED
  		StateName				= STATE_ReallyDamaged
      	Animation				= ReallyDamagedanimation
			AnimationName		= GBCASTELEV_D2.GBCASTELEV_D2
			AnimationMode		= ONCE
   		End
    End

	; RUBBLE ----------------------------------------------------------------------------------------------------------------
	TransitionState = TRANS_U_IntoRubble
		Animation = D3
			AnimationName		= GBCASTELEV_UD3.GBCASTELEV_UD3
			AnimationMode		= ONCE
			AnimationBlendTime = 0
		End
		ParticleSysBone NONE Explosion3
		ParticleSysBone NONE ExplosiveMineSmoke02
	End
    ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
      Model         = GBCASTELEV_UD3
    End
    AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
		StateName				= STATE_Rubble
		Flags					= START_FRAME_LAST
		Animation				= Death_U
			AnimationName		= GBCASTELEV_UD3.GBCASTELEV_UD3
			AnimationMode		= MANUAL
			AnimationBlendTime	= 0
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
			then
				; Only play the rubble anim if we havn't come from another rubble.
				CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
			end
		EndScript
		;EnteringStateFX	= FX_WallDie
    End

   ModelConditionState  = RUBBLE
      Model         = GBCASTELEV_D3
      ParticleSysBone NONE Explosion3
      ParticleSysBone NONE ExplosiveMineSmoke02
    End    
    AnimationState = RUBBLE
		StateName				= STATE_Rubble
		Animation				= Death
			AnimationName		= GBCASTELEV_D3.GBCASTELEV_D3
			AnimationMode		= ONCE
		End
		EnteringStateFX	= FX_WallDie
    End
  		
	ModelConditionState = UPGRADE_NUMENOR_STONEWORK
  		Model = GBCASTELEV_U
  	End

  	AnimationState = UPGRADE_NUMENOR_STONEWORK
		EnteringStateFX = GenericBuildingUpgrade
	End		

;    ModelConditionState  = POST_RUBBLE
;		Model         = None
 ;   End

  ;  ModelConditionState  = POST_COLLAPSE
;		 Model         = None
 ;   End


  End


  ; *** AUDIO Parameters ***

	VoiceSelect			= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	UnitSpecificSounds
		UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:WallDie		Animation:GBCASTELEV_UD3.GBCASTELEV_UD3	Frames:0
	End


  ; ***DESIGN parameters ***
  DisplayName      = OBJECT:GondorCastleElevator
  Side = Isengard
  EditorSorting = STRUCTURE
; Browser = CINEMATICS UNIT
	BuildTime		= CASTLE_WALL_REBUILD_TIME
	BuildCost		= CASTLE_WALL_REBUILD_COST

  ArmorSet
    Conditions        = None
    Armor             = GondorCastleWall
    DamageFX          = MinasWallADamageFX
  End
	
	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR NOT_AUTOACQUIRABLE SELECTABLE
	RadarPriority			= STRUCTURE
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		  = GONDOR_CASTLE_WALL_HEALTH
		
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0
	End

    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End
 
 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
	End
   
	Behavior = DynamicPortalBehaviour Portal
		GenerateNow		= Yes
		ObjectFilter	= ANY +INFANTRY -MONSTER -MACHINE -CAVALRY -ARMY_OF_DEAD
		AllowEnemies	= Yes	; Normally, only allies can use this
		BonePrefix		= Elev
		NumberOfBones	= 4
		
		WayPoint		= Index:0	Type:PreClimb	; 0
		WayPoint		= Index:1	Type:PreClimb	; 1
		WayPoint		= Index:2	Type:Climb	; 2
		WayPoint		= Index:3	Type:Climb	; 3
		WayPoint		= Index:2	Type:Climb	; 4
		WayPoint		= Index:1	Type:Climb	; 5

		Link			= From:0 Via:4 Via:5 To:3	; up, to centre
		Link			= From:3 Via:1 Via:2 To:0	; down, from centre
	End


  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		ObjectFilter	= ALL -MACHINE
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	
	
    Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
    End 
	
	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_NumenorStonework
		AttributeModifier		= NumenorStonework_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 24.0
	GeometryMinorRadius				= 70.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-3 Y:0 Z:0
	
	AdditionalGeometry				= CYLINDER
	GeometryMajorRadius				= 26.0
	GeometryMinorRadius				= 0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y:-80 Z:0
	
	AdditionalGeometry				= CYLINDER
	GeometryMajorRadius				= 26.0
	GeometryMinorRadius				= 0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y:80 Z:0
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 15.0
	GeometryMinorRadius				= 14.0
	GeometryHeight					= 102.0
	GeometryOffset					= X:-30 Y:0 Z:0
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y: 98 Z:0
	GeometryName					= Bookend
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y:-98 Z:0
	GeometryName					= Bookend
	
	
	GeometryIsSmall					= No
	GeometryRotationAnchorOffset	= X:375.0 Y:0.0
	Shadow							= SHADOW_VOLUME
	
	GeometryContactPoint			= X: 0  Y: 0  Z:53 Swoop
	GeometryContactPoint			= X: 30 Y:-70 Z:0 Grab
	GeometryContactPoint			= X:-20 Y:-60 Z:0 Grab
	GeometryContactPoint			= X: 23 Y:-40 Z:0 Grab
	GeometryContactPoint			= X:-40 Y:-40 Z:0 Grab
	GeometryContactPoint			= X: 33 Y: 40 Z:0 Grab
	GeometryContactPoint			= X:-40 Y: 40 Z:0 Grab
	GeometryContactPoint			= X: 30 Y: 60 Z:0 Grab
	GeometryContactPoint			= X:-40 Y: 70 Z:0 Grab

End  

;----------------------------------------------------------------------------------------------
Object GondorCastleWall_for_isen_EM //
        
        SelectPortrait = BPCastleWall
	Draw = W3DScriptedModelDraw Draw_Wall
		OkToChangeModelColor = Yes

	RandomTexture = iborctent2_bib_s.tga 0 gbcastewall.tga

	    WallBoundsMesh = P1

		DefaultModelConditionState
			Model = GBCASTWALL
		End

		ModelConditionState = WORLD_BUILDER
  			Model = GBCASTWALLW
  		End

		ModelConditionState = BASE_BUILD
  			Model = GBCASTWALL_A
  		End
		AnimationState = BASE_BUILD
			StateName = STATE_None
			Animation
				AnimationName = GBCASTWALL_A.GBCASTWALL_A
				AnimationMode = ONCE
				AnimationSpeedFactorRange = 2.0 2.5 ; keep range wide to avoid lockstep anims
			End
		End    
		
		ModelConditionState = JUST_BUILT
  			Model = GBCASTWALL_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = GBCASTWALL_A.GBCASTWALL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End

		; Need to enforce this model for this state because we can
		; repair a numenor upgraded wall.
		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
  			Model = GBCASTWALL_UA
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
			Animation
				AnimationName = GBCASTWALL_UA.GBCASTWALL_UA
				AnimationMode = MANUAL
			End
			StateName = STATE_None
			Flags = START_FRAME_FIRST
		End    

		ModelConditionState = ACTIVELY_BEING_CONSTRUCTED
  			Model = GBCASTWALL_A
  		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = GBCASTWALL_A.GBCASTWALL_A
				AnimationMode = MANUAL
			End
			StateName = STATE_None
			Flags = START_FRAME_FIRST
		End    
		
		; DAMAGED ----------------------------------------------------------------------------------------------------------------
		ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTWALL_UD1
		End
		
		ModelConditionState  = DAMAGED 
			Model         = GBCASTWALL_D1  
		End

		AnimationState = DAMAGED
			StateName = STATE_None
;			EnteringStateFX = FX_MinWallATransitionDamaged
		End
 
		; REALLYDAMAGED ----------------------------------------------------------------------------------------------------------------
		TransitionState = TRANS_U_IntoReallyDamaged
			EnteringStateFX		= FX_BuildingReallyDamaged
			Animation = D2
				AnimationName		= GBCASTWALL_UD2.GBCASTWALL_UD2
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
			End
		End
		ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTWALL_UD2
		End
		AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
			StateName = STATE_ReallyDamaged
	 		Flags = START_FRAME_LAST
			Animation				= ReallyDamagedanimation
				AnimationName		= GBCASTWALL_UD2.GBCASTWALL_UD2
				AnimationMode		= MANUAL
				AnimationBlendTime	= 0
   			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_None" or Prev == "STATE_Rubble"
				then
					; Only play the really damaged anim if we havn't come from another really damaged.
					CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
				end
			EndScript
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = GBCASTWALL_D2
		End
		AnimationState = REALLYDAMAGED
			StateName				= STATE_ReallyDamaged
			Animation				= ReallyDamagedanimation
				AnimationName		= GBCASTWALL_D2.GBCASTWALL_D2
				AnimationMode		= ONCE
   			End
		End

		; RUBBLE ----------------------------------------------------------------------------------------------------------------
		TransitionState = TRANS_U_IntoRubble
			Animation = D3
				AnimationName		= GBCASTWALL_UD3.GBCASTWALL_UD3
				AnimationMode		= ONCE
				AnimationBlendTime = 0
			End
		End
		ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTWALL_UD3
      ParticleSysBone NONE BuildingChunkBitsTrail
      ParticleSysBone NONE ExplosiveMineFire02
    End
		AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
			StateName = STATE_Rubble
			Flags = START_FRAME_LAST
			Animation				= Death
				AnimationName		= GBCASTWALL_UD3.GBCASTWALL_UD3
				AnimationMode		= MANUAL
			AnimationBlendTime		= 0
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
				then
					; Only play the rubble anim if we havn't come from another rubble.
					CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
				end
			EndScript
			;EnteringStateFX	= FX_WallDie	;this plays only after all the wall debris sink into the ground
		End
		
		ModelConditionState  = RUBBLE
			Model         = GBCASTWALL_D3
      ParticleSysBone NONE BuildingChunkBitsTrail
      ParticleSysBone NONE ExplosiveMineFire02
    End
		AnimationState = RUBBLE
			Animation				=	Death
				AnimationName		=	GBCASTWALL_D3.GBCASTWALL_D3
				AnimationMode		=	ONCE
			End
			StateName = STATE_Rubble
			EnteringStateFX	= FX_WallDie
		End      
 
 		; UPGRADED ----------------------------------------------------------------------------------------------------------------
  		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
  			Model = GBCASTWALL_U
  		End

  		AnimationState = UPGRADE_NUMENOR_STONEWORK
			EnteringStateFX = GenericBuildingUpgrade
		End

		ModelConditionState  = POST_RUBBLE
			Model         = None
		End

		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End
		
	End
	
  
	;----------------------- AUDIO -------------------------

	VoiceSelect				= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
 		AnimationSound = Sound:WallDie	Animation:GBCASTWALL_UD3.GBCASTWALL_UD3	Frames:0
	End


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:GondorCastleWall
	EditorSorting	= STRUCTURE
	Side			= Isengard
	BuildTime		= CASTLE_WALL_REBUILD_TIME
	BuildCost		= CASTLE_WALL_REBUILD_COST
  	ShroudClearingRange = 160

	ArmorSet
		Conditions	= None
		Armor		= GondorCastleWall
		DamageFX	= MinasWallADamageFX
	End

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE ;;;should this get autoacquired, or not? NO! or attack move will fail to enter the gate!
	RadarPriority			= STRUCTURE
	VisionRange				= GONDOR_ARCHER_VISION_RANGE
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= GONDOR_CASTLE_WALL_HEALTH
		
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0
	End

	Behavior                  = BuildingBehavior BuildingModuleTag
		NightWindowName         = WINDOW_N01
	;	FireWindowName          = WINDOW_F01
	;	GlowWindowName			= WINDOW_G01
	;	FireName				= FIRE01
	End
	
	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
	End

    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
    End
	
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

    Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
    End 

  	Behavior = AttributeModifierAuraUpdate ModuleTag_WallBonus
		StartsActive	= Yes ;If no, requires upgrade to turn on.
		BonusName		= WallBonus
		RefreshDelay	= 2000
		ObjectFilter	= ALL -MACHINE
		;Range			= 120		; Range is overridden to affect people on us since we are a wall
		;TargetEnemy		= Yes	; Alliances are ignored to affect people on us since we are a wall
	End	

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_NumenorStonework
		AttributeModifier		= NumenorStonework_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 22.0
	GeometryMinorRadius				= 90.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-3 Y:0 Z:0
	
	AdditionalGeometry				= CYLINDER
	GeometryMajorRadius				= 26.0
	GeometryMinorRadius				= 0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y:-80 Z:0
	
	AdditionalGeometry				= CYLINDER
	GeometryMajorRadius				= 26.0
	GeometryMinorRadius				= 0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y:80 Z:0

	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y: 98 Z:0
	GeometryName					= Bookend
	
	AdditionalGeometry				= BOX
	GeometryMajorRadius				= 18.0
	GeometryMinorRadius				= 1.0
	GeometryHeight					= 53.0
	GeometryOffset					= X:-10 Y:-98 Z:0
	GeometryName					= Bookend
	
	GeometryContactPoint			= X:-29.397		Y:0.326		Z:108.421		Swoop
	GeometryContactPoint			= X: 40 Y:-70 Z:0 Grab
	GeometryContactPoint			= X:-40 Y:-60 Z:0 Grab
	GeometryContactPoint			= X: 23 Y:-40 Z:0 Grab
	GeometryContactPoint			= X:-18 Y:-40 Z:0 Grab
	GeometryContactPoint			= X: 23 Y: 40 Z:0 Grab
	GeometryContactPoint			= X:-40 Y: 40 Z:0 Grab
	GeometryContactPoint			= X: 40 Y: 60 Z:0 Grab
	GeometryContactPoint			= X:-40 Y: 70 Z:0 Grab
	
	
	GeometryIsSmall					= No
	GeometryRotationAnchorOffset	= X:375.0 Y:0.0
	Shadow							= SHADOW_VOLUME
End   

Object GondorCastleGateL_for_isen_EM
        
        SelectPortrait = BPCastleWall
	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw Draw_Wall
		OkToChangeModelColor = Yes

		RandomTexture = iborctent2_bib_s.tga 0 gbcastewall.tga

	    WallBoundsMesh = P1

		DefaultModelConditionState
			Model = GBCASTGATEL
		End
		
		ModelConditionState = WORLD_BUILDER
  			Model = GBCASTGATELW
  		End
  		  		
		ModelConditionState = BASE_BUILD
  			Model = GBCASTGATEL_A
  		End
		AnimationState = BASE_BUILD
			StateName = STATE_None
			Animation
				AnimationName = GBCASTGATEL_A.GBCASTGATEL_A
				AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.5 ; keep range wide to avoid lockstep anims
			End
		End
		
		ModelConditionState = JUST_BUILT
  			Model = GBCASTGATEL_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = GBCASTGATEL_A.GBCASTGATEL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End
  		  		
		ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
			Model = GBCASTGATEL_UA  
		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
			Animation
				AnimationName = GBCASTGATEL_UA.GBCASTGATEL_UA
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
			StateName = STATE_None
		End    

		ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
			Model = GBCASTGATEL_A  
		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = GBCASTGATEL_A.GBCASTGATEL_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
			StateName = STATE_None
		End    

;		IdleAnimationState
;			BeginScript
;				CurDrawableAllowToContinue()
;			EndScript
;		
;			; Don't want the entire anim to play.
;			Flags = START_FRAME_LAST
;			Animation
;			StateName		= STATE_None
;				AnimationName = GBCASTGATEL.GBCASTGATEL
;				AnimationMode = ONCE
;			End
;		End
		
		ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTGATL_UD1
		End
		
		ModelConditionState  = DAMAGED
			Model         = GBCASTGATEL_D1  
		End
	    
		AnimationState = DAMAGED
			StateName		= STATE_None
	;      EnteringStateFX = FX_MinWallATransitionDamaged
		End

		; REALLYDAMAGED ----------------------------------------------------------------------------------------------------------------
		TransitionState = TRANS_U_IntoReallyDamaged
			EnteringStateFX		= FX_BuildingReallyDamaged
			Animation = D2
				AnimationName		= GBCASTGATL_UD2.GBCASTGATL_UD2
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
			End
		End
		ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTGATL_UD2
		End
		AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
			StateName			= STATE_ReallyDamaged
	 		Flags				= START_FRAME_LAST
       		Animation			= ReallyDamagedanimation
				AnimationName	= GBCASTGATL_UD2.GBCASTGATL_UD2
				AnimationMode	= ONCE
   			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_None" or Prev == "STATE_Rubble"
				then
					; Only play the really damaged anim if we havn't come from another really damaged.
					CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
				end
			EndScript
		End
		
		ModelConditionState  = REALLYDAMAGED
			Model         = GBCASTGATEL_D2
		End
		AnimationState = REALLYDAMAGED
			StateName			= STATE_ReallyDamaged
       		Animation			= ReallyDamagedanimation
				AnimationName	= GBCASTGATEL_D2.GBCASTGATEL_D2
				AnimationMode	= ONCE
   			End
		End

		; RUBBLE ----------------------------------------------------------------------------------------------------------------
		TransitionState = TRANS_U_IntoRubble
			Animation = D3
				AnimationName		= GBCASTGATL_UD3.GBCASTGATL_UD3
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
			End
		End
		ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTGATL_UD3
		End
		AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
			StateName				= STATE_Rubble
			Flags					= START_FRAME_LAST
			;EnteringStateFX	= FX_WallDie	;this plays after the stone sink into the ground
			Animation				= Death
				AnimationName		= GBCASTGATL_UD3.GBCASTGATL_UD3
				AnimationMode		= MANUAL
				AnimationBlendTime	= 0
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
				then
					; Only play the rubble anim if we havn't come from another rubble.
					CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
				end
			EndScript
		End      
		
		ModelConditionState  = RUBBLE
			Model         = GBCASTGATEL_D3
		End
		AnimationState = RUBBLE
			StateName				= STATE_Rubble
			Animation				= Death
				AnimationName		= GBCASTGATEL_D3.GBCASTGATEL_D3
				AnimationMode		= ONCE
			End
			EnteringStateFX	= FX_WallDie
		End      

  		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
  			Model = GBCASTGATEL_U
  		End

  		AnimationState = UPGRADE_NUMENOR_STONEWORK
			StateName		= STATE_None
			EnteringStateFX = GenericBuildingUpgrade
		End

;		ModelConditionState  = POST_RUBBLE
;			Model         = None
;		End

;		ModelConditionState  = POST_COLLAPSE
;			Model         = None
;		End

	End
	
  
	; *** AUDIO Parameters ***

	VoiceSelect				= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	UnitSpecificSounds
		UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:WallDie	Animation:GBCASTGATL_UD3.GBCASTGATL_UD3	Frames:0
	End


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:GondorCastleGate
	EditorSorting	= STRUCTURE
	Side			= Isengard
	BuildTime		= CASTLE_WALL_REBUILD_TIME
	BuildCost		= CASTLE_WALL_REBUILD_COST

	ArmorSet
		Conditions	= None
		Armor		= DwarvenWallArmor
		DamageFX	= MinasWallADamageFX
	End
	

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE ;;;should this get autoacquired, or not? NO! or attack move will fail to enter the gate!
	RadarPriority			= STRUCTURE
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
	Body				= ActiveBody ModuleTag_02
		MaxHealth		= BFME1_DWARVES_CASTLE_WALL_HEALTH
		
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0
	End

        Behavior                  = BuildingBehavior BuildingModuleTag
           NightWindowName         = WINDOW_N01
        ;  FireWindowName          = WINDOW_F01
        ;  GlowWindowName			= WINDOW_G01
        ;  FireName				= FIRE01
        End
	
;    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
;    End

	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
;	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
;		DestructionDelay  = 3000
;	End
	Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

	#include "..\..\..\..\includes\wallbonus.inc"

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
		SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
	End

    Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
    End 

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_NumenorStonework
		AttributeModifier		= NumenorStonework_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End

	Geometry						= BOX
	GeometryMajorRadius				= 0.1
	GeometryMinorRadius				= 0.1
	GeometryHeight					= 0.1
;	GeometryOffset					= X:-10 Y:55 Z:200

;	Geometry						= BOX
;	GeometryMajorRadius				= 24.0
;	GeometryMinorRadius				= 55.0
;	GeometryHeight					= 52.0
;	GeometryOffset					= X:-3 Y:55 Z:0
	
;	AdditionalGeometry				= CYLINDER
;	GeometryMajorRadius				= 33.0
;	GeometryMinorRadius				= 0
;	GeometryHeight					= 52.0
;	GeometryOffset					= X:-12 Y:105 Z:0
	GeometryRotationAnchorOffset	= X:375.0 Y:0
	GeometryIsSmall					= No
	
	GeometryContactPoint			= X:35		Y: 25		Z:0 Grab
	GeometryContactPoint			= X:21		Y: 25		Z:0 
	GeometryContactPoint			= X:21		Y: 60		Z:52 
	GeometryContactPoint			= X:21		Y: 95		Z:0  
	GeometryContactPoint			= X:31		Y: 95		Z:0 Grab 
	GeometryContactPoint			= X:-50		Y: 95		Z:0 Grab
	GeometryContactPoint			= X:-30		Y: 95		Z:0 
	GeometryContactPoint			= X:-21		Y: 60		Z:52  
	GeometryContactPoint			= X:-21		Y: 25		Z:0 
	GeometryContactPoint			= X:-40		Y: 25		Z:0 Grab

	Shadow							= SHADOW_VOLUME
End


Object GondorCastleGateR_for_isen_EM
        
        SelectPortrait = BPCastleWall
	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw Draw_Wall
		OkToChangeModelColor = Yes

		RandomTexture = iborctent2_bib_s.tga 0 gbcastewall.tga

	    WallBoundsMesh = P1

		DefaultModelConditionState
			Model = GBCASTGATER
		End

		ModelConditionState = WORLD_BUILDER
  			Model = GBCASTGATERW
  		End

		ModelConditionState = BASE_BUILD
  			Model = GBCASTGATER_A
  		End
		AnimationState = BASE_BUILD
			StateName = STATE_None
			Animation
				AnimationName = GBCASTGATER_A.GBCASTGATER_A
				AnimationMode = ONCE
                AnimationSpeedFactorRange = 2.0 2.5 ; keep range wide to avoid lockstep anims
			End
		End
		
		ModelConditionState = JUST_BUILT
  			Model = GBCASTGATER_A
  		End
		AnimationState = JUST_BUILT
			StateName = STATE_None
			Animation
				AnimationName = GBCASTGATER_A.GBCASTGATER_A
				AnimationMode = MANUAL
			End
			Flags = START_FRAME_FIRST
		End		
		
		ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
			Model = GBCASTGATER_UA  
		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
			Animation
				AnimationName = GBCASTGATER_UA.GBCASTGATER_UA
				AnimationMode = MANUAL
			End
			StateName = STATE_None
			Flags = START_FRAME_FIRST
		End    

		ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
			Model = GBCASTGATER_A  
		End
		AnimationState = ACTIVELY_BEING_CONSTRUCTED
			Animation
				AnimationName = GBCASTGATER_A.GBCASTGATER_A
				AnimationMode = MANUAL
			End
			StateName = STATE_None
			Flags = START_FRAME_FIRST
		End    

;		IdleAnimationState
;			BeginScript
;				CurDrawableAllowToContinue()
;			EndScript
;		
;			; Don't want the entire anim to play.
;			Flags = START_FRAME_LAST
;			StateName		= STATE_None
;			Animation
;				AnimationName = GBCASTGATER.GBCASTGATER
;				AnimationMode = ONCE
;			End
;		End
		
		ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTGATR_UD1  
		End
		
		ModelConditionState  = DAMAGED
			Model         = GBCASTGATER_D1  
		End
	    
		AnimationState = DAMAGED
			StateName		= STATE_None
;			EnteringStateFX = FX_MinWallATransitionDamaged
		End

		; REALLYDAMAGED ----------------------------------------------------------------------------------------------------------------
		TransitionState = TRANS_U_IntoReallyDamaged
			EnteringStateFX		= FX_BuildingReallyDamaged
			Animation = D2
				AnimationName		= GBCASTGATR_UD2.GBCASTGATR_UD2
				AnimationMode		= ONCE
				AnimationBlendTime	= 0
			End
		End
		ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTGATR_UD2
		End
		AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
			StateName			= STATE_ReallyDamaged
 			Flags				= START_FRAME_LAST
       		Animation			= ReallyDamagedanimation
				AnimationName	= GBCASTGATR_UD2.GBCASTGATR_UD2
				AnimationMode	= ONCE
   			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_None" or Prev == "STATE_Rubble"
				then
					; Only play the really damaged anim if we havn't come from another really damaged.
					CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
				end
			EndScript
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = GBCASTGATER_D2
		End
		AnimationState = REALLYDAMAGED
			StateName			= STATE_ReallyDamaged
       		Animation			= ReallyDamagedanimation
				AnimationName	= GBCASTGATER_D2.GBCASTGATER_D2
				AnimationMode	= ONCE
   			End
		End

		; RUBBLE ----------------------------------------------------------------------------------------------------------------
		TransitionState = TRANS_U_IntoRubble
			Animation = D3
				AnimationName		= GBCASTGATR_UD3.GBCASTGATR_UD3
				AnimationMode		= ONCE
				AnimationBlendTime = 0
			End
		End
		ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
			Model         = GBCASTGATR_UD3
		End
		AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
			StateName				= STATE_Rubble
			Flags					= START_FRAME_LAST
			;EnteringStateFX	= FX_WallDie	;this plays after the stone sink into the ground
			Animation				=	Death
				AnimationName		=	GBCASTGATR_UD3.GBCASTGATR_UD3
				AnimationMode		= MANUAL
				AnimationBlendTime	= 0
			End
			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
				then
					; Only play the rubble anim if we havn't come from another rubble.
					CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
				end
			EndScript
		End      

		ModelConditionState  = RUBBLE
			Model         = GBCASTGATER_D3
		End	    
		AnimationState = RUBBLE
			StateName				= STATE_Rubble
			Animation				=	Death
				AnimationName		=	GBCASTGATER_D3.GBCASTGATER_D3
				AnimationMode		=	ONCE
			End
			EnteringStateFX	= FX_WallDie
		End      
  		
  		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
  			Model = GBCASTGATER_U
  		End

  		AnimationState = UPGRADE_NUMENOR_STONEWORK
			StateName		= STATE_None
			EnteringStateFX = GenericBuildingUpgrade
		End

;		ModelConditionState  = POST_RUBBLE
;			Model         = None
;		End

;		ModelConditionState  = POST_COLLAPSE
;			Model         = None
;		End
	End
	
  
	; *** AUDIO Parameters ***

	VoiceSelect				= Gui_PlotSelect

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

	VoiceSelectUnderConstruction	= BuildingGoodVoiceSelectUnderConstruction

	UnitSpecificSounds
		UnderConstruction		= BuildingConstructionLoop  ; Built first time
		; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
		UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
	End

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:WallDie	Animation:GBCASTGATR_UD3.GBCASTGATR_UD3	Frames:0
	End


	; ***DESIGN parameters ***
	DisplayName		= OBJECT:GondorCastleGate
	EditorSorting	= STRUCTURE
	Side			= Isengard
	BuildTime		= CASTLE_WALL_REBUILD_TIME
	BuildCost		= CASTLE_WALL_REBUILD_COST

	ArmorSet
		Conditions	= None
		Armor		= DwarvenWallArmor
		DamageFX	= MinasWallADamageFX
	End
	

	; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE NOT_AUTOACQUIRABLE ;;;should this get autoacquired, or not? NO! or attack move will fail to enter the gate!
	RadarPriority			= STRUCTURE
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet
	
        Behavior                  = BuildingBehavior BuildingModuleTag
           NightWindowName         = WINDOW_N01
        ;  FireWindowName          = WINDOW_F01
        ;  GlowWindowName			= WINDOW_G01
        ;  FireName				= FIRE01
        End

	Body				= ActiveBody ModuleTag_02
		MaxHealth		= BFME1_DWARVES_CASTLE_WALL_HEALTH
		
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0
	End

;    Behavior = SiegeDockingBehavior ModuleTag_SiegeDocking
;    End

	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
;	Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
;		DestructionDelay  = 3000
;	End
	Behavior = KeepObjectDie ModuleTag_IWantRubble
    End

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
	End

	Behavior = ProductionUpdate ProductionUpdateModuleTag
		; nothing, but is required if we have any Object-level Upgrades!
	End

	#include "..\..\..\..\includes\wallbonus.inc"

	Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = Yes
	End 

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_NumenorStonework
		AttributeModifier		= NumenorStonework_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag2
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= StandardWallDeath
	End	

 	Behavior = FireWeaponWhenDeadBehavior FireDeadTag1
		DeathTypes					= ALL
		StartsActive				= Yes
		ActiveDuringConstruction	= Yes
		DeathWeapon					= CastleWallDeath
	End	

	Geometry						= BOX
	GeometryMajorRadius				= 0.1
	GeometryMinorRadius				= 0.1
	GeometryHeight					= 0.1
	GeometryOffset					= X:-3 Y:5 Z:200


;	Geometry						= BOX
;	GeometryMajorRadius				= 24.0
;	GeometryMinorRadius				= 55.0
;	GeometryHeight					= 52.0
;	GeometryOffset					= X:-3 Y:-55 Z:0
	
;	AdditionalGeometry				= CYLINDER
;	GeometryMajorRadius				= 33.0
;	GeometryMinorRadius				= 0
;	GeometryHeight					= 52.0
;	GeometryOffset					= X:-12 Y:-105 Z:0
	
	GeometryRotationAnchorOffset	= X:375.0 Y:0
	GeometryIsSmall					= No
	
	GeometryContactPoint			= X:35		Y: -25		Z:0 Grab
	GeometryContactPoint			= X:21		Y: -25		Z:0 
	GeometryContactPoint			= X:21		Y: -60		Z:52 
	GeometryContactPoint			= X:21		Y: -95		Z:0  
	GeometryContactPoint			= X:31		Y: -95		Z:0 Grab 
	GeometryContactPoint			= X:-50		Y: -95		Z:0 Grab
	GeometryContactPoint			= X:-30		Y: -95		Z:0 
	GeometryContactPoint			= X:-21		Y: -60		Z:52  
	GeometryContactPoint			= X:-21		Y: -25		Z:0 
	GeometryContactPoint			= X:-40		Y: -25		Z:0 Grab

	
	Shadow							= SHADOW_VOLUME
End

Object GondorCastleGateTower_for_isen_EM	//  

  ; *** ART Parameters ***
  Draw = W3DScriptedModelDraw ModuleTag_01
    RandomTexture = iborctent2_bib_s.tga 0 gbcastewall.tga
    OkToChangeModelColor = Yes
    WallBoundsMesh = P1
    RampMesh1 = Ramp1
    
    DefaultModelConditionState
      Model = GBCastPed
    End

	ModelConditionState = WORLD_BUILDER
  		Model = GBCASTPEDW
  	End

	IdleAnimationState
 		StateName			 = STATE_None
		Flags				 = START_FRAME_LAST
		Animation
			AnimationName     = GBCastPed.GBCastPed
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
        End
	End    

	ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
		Model = GBCastPed_UA
	End
	AnimationState = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
		StateName			= STATE_None
		Flags				= START_FRAME_FIRST
		Animation
			AnimationName = GBCastPed_UA.GBCastPed_UA
			AnimationMode = MANUAL
		End
	End    

	ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
		Model = GBCastPed  
	End
	AnimationState = ACTIVELY_BEING_CONSTRUCTED
		StateName			= STATE_None
		Flags				= START_FRAME_FIRST
		Animation
			AnimationName = GBCastPed.GBCastPed
			AnimationMode = MANUAL
		End
	End    

    ;------------Build Up States
    ModelConditionState   = BASE_BUILD
      Model               = GBCastPed
      ParticleSysBone     = NONE BuildingContructDust
    End  
	AnimationState		  = BASE_BUILD
		StateName				= STATE_None
		Animation
			AnimationName = GBCastPed.GBCastPed
			AnimationMode = ONCE
			AnimationSpeedFactorRange = 2.0 2.5 ; keep range wide to avoid lockstep anims
		End
	End

	AnimationState = JUST_BUILT
		StateName				= STATE_None
        Flags					= START_FRAME_FIRST
		Animation
			AnimationName		= GBCastPed.GBCastPed
			AnimationMode		= MANUAL
			AnimationBlendTime	= 0
		End
	End    
	
	; DAMAGED ----------------------------------------------------------------------------------------------------------------
    ModelConditionState = DAMAGED UPGRADE_NUMENOR_STONEWORK
		Model			= GBCastPed_UD1  
    End
    AnimationState = DAMAGED UPGRADE_NUMENOR_STONEWORK
		StateName		= STATE_None
		EnteringStateFX	= FX_BuildingDamaged
    End
    ModelConditionState = DAMAGED
		Model			= GBCastPed_D1  
    End
    AnimationState = DAMAGED
		StateName		= STATE_None
		EnteringStateFX	= FX_BuildingDamaged
    End

	; REALLYDAMAGED ----------------------------------------------------------------------------------------------------------------
	TransitionState = TRANS_U_IntoReallyDamaged
		EnteringStateFX		= FX_BuildingReallyDamaged
		Animation = D2
			AnimationName		= GBCastPed_UD2.GBCastPed_UD2
			AnimationMode		= ONCE
			AnimationBlendTime	= 0
		End
	End

    ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastPed_UD2
    End
    AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
		StateName			= STATE_ReallyDamaged
 		Flags				= START_FRAME_LAST
      	Animation			= ReallyDamagedanimation
			AnimationName	= GBCastPed_UD2.GBCastPed_UD2
			AnimationMode	= MANUAL
			AnimationBlendTime = 0
	   	End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_None" or Prev == "STATE_Rubble"
			then
				; Only play the really damaged anim if we havn't come from another really damaged.
				CurDrawableSetTransitionAnimState("TRANS_U_IntoReallyDamaged")
			end
		EndScript
   	End

    ModelConditionState  = REALLYDAMAGED
      Model         = GBCastPed_D2
    End
    AnimationState = REALLYDAMAGED
		StateName			= STATE_ReallyDamaged
       	Animation			= ReallyDamagedanimation
			AnimationName	= GBCastPed_D2.GBCastPed_D2
			AnimationMode	= ONCE
			AnimationBlendTime = 0
   		End
		EnteringStateFX	= FX_BuildingReallyDamaged
    End

	; RUBBLE ----------------------------------------------------------------------------------------------------------------
	TransitionState = TRANS_U_IntoRubble
		Animation = D3
			AnimationName		= GBCastPed_U_D3.GBCastPed_U_D3
			AnimationMode		= ONCE
			AnimationBlendTime = 0
		End
	End

    ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
      Model						= GBCastPed_U_D3
    End
    AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
		StateName				= STATE_Rubble
		Flags					= START_FRAME_LAST
		;EnteringStateFX	= FX_WallDie	;this plays after the stone sink into the ground
		Animation				= Death
			AnimationName		= GBCastPed_U_D3.GBCastPed_U_D3
			AnimationMode		= MANUAL
			AnimationBlendTime	= 0
		End
		BeginScript
			Prev = CurDrawablePrevAnimationState()
			if Prev == "STATE_ReallyDamaged" or Prev == "STATE_None" or Prev == "TRANS_U_IntoReallyDamaged"
			then
				; Only play the rubble anim if we havn't come from another rubble.
				CurDrawableSetTransitionAnimState("TRANS_U_IntoRubble")
			end
		EndScript
    End

    ModelConditionState  = RUBBLE
      Model         = GBCastPed_D3
    End
    AnimationState = RUBBLE
		StateName				= STATE_Rubble
		Animation				= Death
			AnimationName		= GBCastPed_D3.GBCastPed_D3
			AnimationMode		= ONCE
			AnimationBlendTime	= 0
		End
		EnteringStateFX	= FX_WallDie
    End      

 	; ----------------------------------------------------------------------------------------------------------------
   ModelConditionState  = UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastPed_U
    End
	AnimationState = UPGRADE_NUMENOR_STONEWORK
		StateName		= STATE_None
		EnteringStateFX = GenericBuildingUpgrade
	End	

  End

  ; *** AUDIO Parameters ***

	#include "..\..\..\Includes\StandardBuildingEvaEvents.inc"
	SoundOnDamaged		= BuildingLightDamageStone
	SoundOnReallyDamaged	= BuildingHeavyDamageStone

	ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
		MaxUpdateRangeCap = 800
		AnimationSound = Sound:WallDie	Animation:GBCastPed_U_D3.GBCastPed_U_D3	Frames:0
	End
	CampnessValue = CAMPNESS_WALL


  ; ***DESIGN parameters ***

	DisplayName     = OBJECT:GondorCastleGateTower
	Side			= Isengard
	EditorSorting	= STRUCTURE
	BuildTime		= CASTLE_WALL_REBUILD_TIME
	BuildCost		= CASTLE_WALL_REBUILD_COST

  VisionRange         = 160.0          ; Shroud clearing distance
  ShroudClearingRange = 160

  ArmorSet
    Conditions        = None
    Armor             = StructureArmor
    DamageFX          = MinasWallADamageFX
  End

  ; *** ENGINEERING Parameters ***  
	KindOf					= STRUCTURE IMMOBILE WALK_ON_TOP_OF_WALL CHUNK_VENDOR SELECTABLE MADE_OF_STONE NOT_AUTOACQUIRABLE
	RadarPriority			= STRUCTURE
	KeepSelectableWhenDead	= Yes
	CommandSet				= GenericSelfRepairCommandSet

  Body                  = ActiveBody ModuleTag_03
    MaxHealth       = 5000.0
  End

  ; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
  ; never truly destroyed, even when reduced to zero health. Also note that garrisonable
  ; buildings automatically stick around because GarrisonContain has it's own DieModule
  
    Behavior = KeepObjectDie ModuleTag_IWantRubble
    End
  
    Behavior = CastleMemberBehavior ModuleTag_CMB
    End 
  
	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_NumenorStonework
		AttributeModifier		= NumenorStoneworkKeep_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End

 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
		SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds = CASTLE_WALL_REBUILD_TIME
	End 
  
	Geometry              = BOX
	GeometryMajorRadius   = 1.0
	GeometryMinorRadius   = 1.0
	GeometryHeight        = 1.0
	GeometryIsSmall       = No

;	Geometry              = BOX
;	GeometryMajorRadius   = 20.0
;	GeometryMinorRadius   = 50.0
;	GeometryHeight        = 45.0
;	GeometryIsSmall       = No
;	;GeometryRotationAnchorOffset = X:1037.871 Y:0
	Shadow                = SHADOW_VOLUME
	
	GeometryContactPoint = X:-10  Y:-40  Z:0 Grab
	GeometryContactPoint = X:40   Y:0    Z:0 Grab
	GeometryContactPoint = X:-10  Y:40   Z:0 Grab
	GeometryContactPoint = X:-10  Y:25   Z:45
	GeometryContactPoint = X:15   Y:15   Z:5
	GeometryContactPoint = X:20   Y:0    Z:45
	GeometryContactPoint = X:15   Y:-15  Z:5
	GeometryContactPoint = X:-10  Y:-25  Z:45
	GeometryContactPoint = X:-10  Y:-25  Z:5
End

;----------------------------------------------------------------------------------------------
Object GondorCastleBridge_for_isen_EM 	//

	; *** ART Parameters ***
	Draw = W3DScriptedModelDraw ModuleTag_01
	
	RandomTexture = iborctent2_bib_s.tga 0 gbcastewall.tga

		RampMesh1 = P2
		RampMesh2 = P3
	    	RaisedWallMesh = P1
	    
	                    		    
		DefaultModelConditionState
			Model = GBCastBrdg
;			ParticleSysBone   = glowbone01 TorchSmokeBlack
;			ParticleSysBone   = glowbone02 TorchGlow
;			ParticleSysBone   = glowbone03 TorchSmokeBlack
;			ParticleSysBone   = glowbone04 TorchGlow
		End
  		
	IdleAnimationState
		Animation
			AnimationName     = GBCastBrdg.GBCastBrdg
			AnimationMode     = MANUAL
			AnimationBlendTime = 0
        End
        Flags = START_FRAME_LAST
	End    

    ;------------Build Up States
    ModelConditionState   = BASE_BUILD
      Model               = GBCastBrdg
;      ParticleSysBone	  = NONE BuildingDoughnutCloud
      ParticleSysBone     = NONE BuildingContructDust
    End  
	AnimationState		  = BASE_BUILD
		Animation
			AnimationName = GBCastBrdg.GBCastBrdg
			AnimationMode = ONCE
			AnimationSpeedFactorRange = 2.0 2.5 ; keep range wide to avoid lockstep anims
		End
	End

	AnimationState		  = JUST_BUILT
		Animation
			AnimationName = GBCastBrdg.GBCastBrdg
			AnimationMode = MANUAL
			AnimationBlendTime = 0
		End
        Flags = START_FRAME_FIRST
	End    
	
    ModelConditionState  = DAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_U_D1
    End
    ModelConditionState  = DAMAGED
      Model         = GBCastBrdg_D1
    End
    AnimationState = DAMAGED
    End

    ModelConditionState  = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_UD2
    End
    AnimationState = REALLYDAMAGED UPGRADE_NUMENOR_STONEWORK
        Animation				=	ReallyDamagedanimation
			AnimationName		=	 GBCastBrdg_UD2.GBCastBrdg_UD2
			AnimationMode		=	ONCE
;           AnimationSpeedFactorRange = 0.5 0.5
   		End
    End	

    ModelConditionState  = REALLYDAMAGED
      Model         = GBCastBrdg_D2
    End
    AnimationState = REALLYDAMAGED
        Animation				=	ReallyDamagedanimation
			AnimationName		=	 GBCastBrdg_D2.GBCastBrdg_D2
			AnimationMode		=	ONCE
;           AnimationSpeedFactorRange = 0.5 0.5
   		End
    End	
    
    ModelConditionState  = RUBBLE UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_UD3  
;      ParticleSysBone emberBone01 TrebuchetImpactDebris
;      ParticleSysBone emberBone02 SmokeBuildingLarge
;      ParticleSysBone emberBone03 PCTMediumDust
    End
    AnimationState = RUBBLE UPGRADE_NUMENOR_STONEWORK
    	Animation				=	Death
			AnimationName		=	GBCastBrdg_UD3.GBCastBrdg_UD3
			AnimationMode		=	ONCE
;           AnimationSpeedFactorRange = 0.5 0.5
		End
		EnteringStateFX	= FX_WallDie
    End


	ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
      Model         = GBCastBrdg_U_D1
    End
	ModelConditionState  = ACTIVELY_BEING_CONSTRUCTED
      Model         = GBCastBrdg_D1
    End


	AnimationState  = ACTIVELY_BEING_CONSTRUCTED UPGRADE_NUMENOR_STONEWORK
    	Animation				=	Death
			AnimationName		=	GBCastBrdg_UD3.GBCastBrdg_UD3
			AnimationMode		=	ONCE
		End
    End
	AnimationState  = ACTIVELY_BEING_CONSTRUCTED
    	Animation				=	Death
			AnimationName		=	GBCastBrdg_D3.GBCastBrdg_D3
			AnimationMode		=	ONCE
		End
    End




    ModelConditionState  = RUBBLE
      Model         = GBCastBrdg_D3  
;      ParticleSysBone emberBone01 TrebuchetImpactDebris
;      ParticleSysBone emberBone02 SmokeBuildingLarge
;      ParticleSysBone emberBone03 PCTMediumDust
    End
    AnimationState = RUBBLE
    	Animation				=	Death
			AnimationName		=	GBCastBrdg_D3.GBCastBrdg_D3
			AnimationMode		=	ONCE
;           AnimationSpeedFactorRange = 0.5 0.5
		End
		EnteringStateFX	= FX_WallDie
    End
		
		ModelConditionState = UPGRADE_NUMENOR_STONEWORK
  			Model = GBCastBrdg_U
;			ParticleSysBone   = glowbone01 TorchSmokeBlack
;			ParticleSysBone   = glowbone02 TorchGlow
;			ParticleSysBone   = glowbone03 TorchSmokeBlack
;			ParticleSysBone   = glowbone04 TorchGlow
  		End

  		AnimationState = UPGRADE_NUMENOR_STONEWORK
			EnteringStateFX = GenericBuildingUpgrade
		End		

  	ModelConditionState  = POST_RUBBLE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End
	ModelConditionState  = POST_COLLAPSE
		Model         = None
		ParticleSysBone NONE SmokeBuildingMediumRubble
	End

  End

  ; *** AUDIO Parameters ***

	SoundOnDamaged			= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

	;VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction


  ; ***DESIGN parameters ***
  DisplayName      = OBJECT:GondorCastleGate
  Side = Isengard
  EditorSorting = STRUCTURE
; Browser = CINEMATICS UNIT

  ArmorSet
    Conditions        = None
    Armor             = DwarvenWallArmor
    DamageFX          = MinasWallADamageFX
  End

  ; *** ENGINEERING Parameters ***  
;  KindOf                = STRUCTURE SELECTABLE IMMOBILE
;  RadarPriority = STRUCTURE
;  Body                  = ActiveBody ModuleTag_03
;    MaxHealth       = 2000.0
;  End
	KindOf					= STRUCTURE IMMOBILE CHUNK_VENDOR WALK_ON_TOP_OF_WALL SELECTABLE NOT_AUTOACQUIRABLE
	RadarPriority			= STRUCTURE	
	KeepSelectableWhenDead	= Yes

	Body					= ActiveBody ModuleTag_03
	
			MaxHealth				= 6000.0
			MaxHealthDamaged		= 3000.0
			MaxHealthReallyDamaged  = 1000.0
		GrabObject = EntThrownBuildingRock
		GrabFX = FX_WallGrab
		GrabDamage = 490
		GrabOffset = X:16 Y:0
	End

  ; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
  ; never truly destroyed, even when reduced to zero health. Also note that garrisonable
  ; buildings automatically stick around because GarrisonContain has it's own DieModule
;  Behavior = SlowDeathBehavior ModuleTag_SlowDeathWithoutRubble
;      DestructionDelay  = 5000
;  End
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End

    Behavior = CastleMemberBehavior ModuleTag_CMB
		CountsForEvaCastleBreached = No  ; Having the walkway over the gate destroyed doesn't actually let the enemy into the castle
    End 

	Behavior = AttributeModifierUpgrade ModuleTag_Reinforced
		TriggeredBy				= Upgrade_NumenorStonework
		AttributeModifier		= NumenorStonework_Bonus
		CustomAnimAndDuration	= AnimState:UPGRADE_NUMENOR_STONEWORK AnimTime:0
	End
	
	; These are bunched-up together on purpose
	BuildCost		= 0  ; for free, since this serves no purpose
  	CommandSet				= GenericSelfRepairCommandSet   ;
 	Behavior = GettingBuiltBehavior ModuleTag_GettingBuilt
	    SelfBuildingLoop = BuildingConstructionLoop ; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop  = NoSound         ; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop  = BuildingConstructionLoop
		SpawnTimer = -1.0 ; Negative means no 'autoheal'
		RebuildTimeSeconds	= 15 ; nice and fast, so we don;t visually block the gateway
	End



  Geometry				= BOX
  GeometryMajorRadius   = 1.0
  GeometryMinorRadius   = 1.0 
  GeometryHeight        = 1.0
  GeometryOffset		= X:-5 Y:10 Z:60  

;  Geometry				= BOX
;  GeometryMajorRadius   = 25.0
;  GeometryMinorRadius   = 82.5 
;  GeometryHeight        = 10.0
;  GeometryOffset		= X:-5 Y:10 Z:60  
  
;  AdditionalGeometry    = BOX
;  GeometryMajorRadius   = 17.5
;  GeometryMinorRadius   = 12.5 
;  GeometryHeight        = 70.0
;  GeometryOffset		= X:25 Y:70 Z:0  

;  AdditionalGeometry    = BOX
;  GeometryMajorRadius   = 17.5
;  GeometryMinorRadius   = 12.5 
;  GeometryHeight        = 70.0
;  GeometryOffset		= X:25 Y:-70 Z:0 




;  AdditionalGeometry    = BOX
;  GeometryMajorRadius   = 37.5
;  GeometryMinorRadius   = 12.5 
;  GeometryHeight        = 20.0
;  GeometryOffset		= X:50 Y:70 Z:0  
      
;  AdditionalGeometry    = BOX
;  GeometryMajorRadius   = 37.5
;  GeometryMinorRadius   = 12.5 
;  GeometryHeight        = 20.0
;  GeometryOffset		= X:50 Y:-70 Z:0  
  
  
;	Geometry						= BOX
;	GeometryMajorRadius				= 32
;	GeometryMinorRadius				= 98.0
;	GeometryHeight					= -30
;	GeometryOffset					= X:0 Y:0 Z:53.0

	GeometryRotationAnchorOffset	= X:375.0 Y:0
	GeometryIsSmall					= No
	
	GeometryContactPoint			= X:70		Y: 72		Z:0 Grab
	GeometryContactPoint			= X:28		Y: 72		Z:0 
	GeometryContactPoint			= X:0		Y: 60		Z:70 
	GeometryContactPoint			= X:0		Y: -60		Z:70 
	GeometryContactPoint			= X:28		Y: -72		Z:0 
	GeometryContactPoint			= X:70		Y: -72		Z:0 Grab

	
	Shadow							= SHADOW_VOLUME
End
