;----------------------------------------------------------------------------

Object EvilMod_DolGoldurCastle

  ; *** ART Parameters ***
  
  SelectPortrait  =  BPCDolGuldurCastle
  
  Draw = W3DScriptedModelDraw ModuleTag_01
	StaticModelLODMode		= yes ;// Will append M or L to the skin name depending on GameLOD

    DefaultModelConditionState
      Model = DGBCastle
    End
    
;------------Build Up States
    ModelConditionState   = ACTIVELY_BEING_CONSTRUCTED ;PARTIALLY_CONSTRUCTED
      Model               = DGBCastle_A
;      ParticleSysBone	  = NONE BuildingDoughnutCloud
      ParticleSysBone     = NONE BuildingContructDust
    End  

	AnimationState          = ACTIVELY_BEING_CONSTRUCTED
		Animation
			AnimationName	= DGBCastle_A.DGBCastle_A
			AnimationMode   = MANUAL
		End
		BeginScript
;			CurDrawableHideSubObject("FIRE02")
		EndScript
	End
    
  	;--damaged building

		ModelConditionState  = DAMAGED
			Model         = DGBCastle_D2
			ParticleSysBone FXbone SmokeBuildingLarge
			ParticleSysBone FXbone CastleExplosion
			ParticleSysBone FXbone CatapultDestroyExplosion
			ParticleSysBone FXbone BuildingDamaged
		End
	    
	    	AnimationState =  DAMAGED
      			Animation			=	ReallyDamagedanimation
				AnimationName		=	DGBCastle_D2SK.DGBCastle_D2AN
				AnimationMode		=	ONCE
  			End
		    	EnteringStateFX	= FX_BuildingReallyDamaged
		End

		ModelConditionState  = REALLYDAMAGED
			Model         = DGBCastle_D3
			ParticleSysBone FXbone SmokeBuildingLarge
			ParticleSysBone FXbone CastleExplosion
		End
		AnimationState = REALLYDAMAGED
      			Animation			=	RubbleAnimation
				AnimationName		=	 DGBCastle_D3SK.DGBCastle_D3AN
				AnimationMode		=	ONCE
  			End
			EnteringStateFX	= FX_BuildingReallyDamaged
		End

   	 	ModelConditionState  = COLLAPSING
      			Model         = DGBCastle_D4
			    ;ParticleSysBone FXbone01 BaradDurWave
     			;ParticleSysBone FXbone02 BaradDurDust01 FollowBone:Yes
      			ParticleSysBone FXbone03 CastleExplosion
      			ParticleSysBone FXbone03 CatapultDestroyExplosion
      			ParticleSysBone FXbone03 BuildingDamaged

    		End
    		AnimationState = COLLAPSING
      			Animation			=	RubbleAnimation
				AnimationName		=	 DGBCastle_D4SK.DGBCastle_D4AN
				AnimationMode		=	ONCE
				AnimationSpeedFactorRange	= 3.0	3.0
				
  			End
			EnteringStateFX	= FX_DGBCastleCollapse
    		End 

		ModelConditionState  = RUBBLE
			Model         = DGBCastle_R
		End
		AnimationState = RUBBLE
		End


		ModelConditionState  = POST_RUBBLE
			Model         = None
		End
		AnimationState = POST_RUBBLE
		End
		
		ModelConditionState  = POST_COLLAPSE
			Model         = None
		End  
		AnimationState = POST_COLLAPSE
		End
  End


  ; *** AUDIO Parameters ***

  #include "..\..\..\Includes\StandardBuildingEvaEvents.inc"

	VoiceSelect						= MordorFortressSelect
	VoiceSelectUnderConstruction	= BuildingEvilVoiceSelectUnderConstruction

	SoundAmbientDamaged			= GenericFireMediumLoop
	SoundAmbientReallyDamaged	= GenericFireLargeLoop
	SoundOnDamaged				= BuildingLightDamageStone
	SoundOnReallyDamaged		= BuildingHeavyDamageStone

  UnitSpecificSounds
    UnderConstruction		= BuildingConstructionLoop  ; Built first time
	; UnderRepairFromDamage	= NoSound					; Repaired No animation on the building, so don't bother playing sound
	UnderRepairFromRubble	= BuildingConstructionLoop	; Repaired from completely destroyed (not used???)
  End

  ClientBehavior = ModelConditionAudioLoopClientBehavior ModuleTag_PlayCollapseSound
		ModelCondition = REQUIRED:RUBBLE Sound:BuildingSink
  End

  ; ***DESIGN parameters ***
	DisplayName		= OBJECT:DolGoldurCastle
	Side			= Mordor
	EditorSorting		= STRUCTURE
	ThreatLevel		= 1.0
	BuildCost		= 5000
	BuildTime		= 120.0		; in seconds
	VisionRange		= 400
	ShroudClearingRange 	= 800

	ArmorSet
		Conditions	= None
		Armor		= FortressArmor
		DamageFX	= None
	End
  
	CommandSet		= EmptyCommandSet

	HealthBoxHeightOffset	= -200


  ; *** ENGINEERING Parameters ***  
	KindOf			= VITAL_FOR_BASE_SURVIVAL PRELOAD SELECTABLE STRUCTURE IMMOBILE SCORE CASTLE_KEEP MP_COUNT_FOR_VICTORY CAN_ATTACK FS_FACTORY AUTO_RALLYPOINT DOZER_FACTORY NEVER_CULL_FOR_MP COMMANDCENTER DONT_HIDE_IF_FOGGED
	RadarPriority		= STRUCTURE
	KeepSelectableWhenDead	= Yes

	//Commandset upgrades based on faction.  This is so the building will produce the proper units when necessary
	Behavior = CommandSetUpgrade ModuleTag_CommandSetMen
		TriggeredBy	= Upgrade_MenFaction
		CommandSet	= MenMonumentFortressRebuildCommandSet
	End
	Behavior = CommandSetUpgrade ModuleTag_CommandSetElven
		TriggeredBy	= Upgrade_ElfFaction
		CommandSet	= ElvenMonumentFortressRebuildCommandSet
	End
	Behavior = CommandSetUpgrade ModuleTag_CommandSetDwarven
		TriggeredBy	= Upgrade_DwarfFaction
		CommandSet	= DwarvenMonumentFortressRebuildCommandSet
	End
	Behavior = CommandSetUpgrade ModuleTag_CommandSetMordor
		TriggeredBy	= Upgrade_MordorFaction
		CommandSet	= MordorMonumentFortressRebuildCommandSet
	End
	Behavior = CommandSetUpgrade ModuleTag_CommandSetIsengard
		TriggeredBy	= Upgrade_IsengardFaction
		CommandSet	= IsengardMonumentFortressRebuildCommandSet
	End
	Behavior = CommandSetUpgrade ModuleTag_CommandSetWild
		TriggeredBy	= Upgrade_WildFaction
		CommandSet	= WildMonumentFortressRebuildCommandSet
	End
	Behavior = CommandSetUpgrade ModuleTag_CommandSetAngmar
		TriggeredBy	= Upgrade_AngmarFaction
		CommandSet	= AngmarMonumentFortressCommandSet
	End
	Behavior = CommandSetUpgrade ModuleTag_CommandSetArnor
		TriggeredBy	= Upgrade_ArnorFaction
		CommandSet	= ArnorMonumentFortressCommandSet
	End
	//End Commandset upgrades

	//Used for hero revival and initial construction     
	Behavior = ProductionUpdate ProductionUpdateModuleTag
		// nothing, but is required if we have any Object-level Upgrades!
	End
	Behavior = QueueProductionExitUpdate ModuleTag_QueuePEU
		UnitCreatePoint			= X:0.0 Y:-75.0 Z:0.0
		NaturalRallyPoint		= X:0.0 Y:-150.0 Z:0.0			; NaturalRallyPointX must always match GeometryMajorRadius!
		ExitDelay			= 300					; Handles delays between units if multiple produced at a time.
		AllowAirborneCreation		= Yes
	End  
	//-----------------------------------------------

	Behavior = GettingBuiltBehavior GetBuiltBehaviorTag
		SelfBuildingLoop		= BuildingConstructionLoop		; Only played if we DON'T spawn a worker
		SelfRepairFromDamageLoop	= NoSound				; This doesn't cause an animation, so don't bother playing a sound
		SelfRepairFromRubbleLoop	= BuildingConstructionLoop
		SpawnTimer			= -1.0					; Negative means no 'autoheal'
		RebuildTimeSeconds		= 120
	End

	Body = StructureBody ModuleTag_05
		MaxHealth			= 30000
		MaxHealthDamaged		= MONUMENT_FORTRESS_HEALTH_DAMAGED
		MaxHealthReallyDamaged		= MONUMENT_FORTRESS_HEALT_REALLY_DAMAGED
  	End
 
	; Note that structures with "RUBBLE" states should not use DestroyDie; such buildings are 
	; never truly destroyed, even when reduced to zero health. Also note that garrisonable
	; buildings automatically stick around because GarrisonContain has it's own DieModule
	Behavior = KeepObjectDie ModuleTag_IWantRubble
	End
 	
	//Money Maker
	Behavior = AutoDepositUpdate AutoDepositModuleTag
		DepositTiming       		= GENERIC_KEEP_MONEY_TIME
		DepositAmount       		= GENERIC_KEEP_MONEY_AMOUNT 
		InitialCaptureBonus 		= 0  // no initial bonus
	End

	Behavior = TerrainResourceBehavior ModuleTag_NewMoneyDeadSpot
		Radius				= GENERIC_KEEP_MONEY_RANGE		; How far we try to claim ground
		MaxIncome			= 50					; If we were to get all we wanted, how much we would earn.  Linear slope to 0 at 0% claim
		IncomeInterval			= 10000				; How often (in msec) we give that much money
		HighPriority			= Yes
		Visible				= YEs					; A high priority claim gets to pretend it was there first.
	End
	
	Behavior = CitadelSlaughterHordeContain ModuleTag_SlaughterMe
		PassengerFilter			= GENERIC_FACTION_SLAUGHTERABLE
		ObjectStatusOfContained		= UNSELECTABLE ENCLOSED
		CashBackPercent			= 200%		
		ContainMax			= 99					; give it a huge capacity, just in case player sends his whole army in at once
		AllowEnemiesInside		= No
		AllowAlliesInside		= No
 		AllowNeutralInside		= No
 		AllowOwnPlayerInsideOverride	= Yes
		EnterSound			= MordorSlaughterhouseEnterSound
		EntryOffset			= X:5.0 Y:-146 Z:0.0
		EntryPosition			= X:5.0 Y:-106 Z:0.0			; entry position needs to be offset from the root transform, otherwise fortress obscures point.

		ExitOffset			= X:5.0 Y:-146 Z:0.0
		StatusForRingEntry		= HOLDING_THE_RING
		UpgradeForRingEntry		= Upgrade_RingHero Upgrade_FortressRingHero
		ObjectToDestroyForRingEntry	= NONE +TheDroppedRing
		FXForRingEntry			= FX_OneRingFlare
	End
	
	#include "..\..\..\FortressRingFunc.inc"

	Geometry		= BOX
	GeometryMajorRadius	= 85
	GeometryMinorRadius	= 100
	GeometryHeight		= 90
	GeometryOffset		= X:5 Y:0 Z:0

	AdditionalGeometry	= BOX
	GeometryMajorRadius	= 20
	GeometryMinorRadius	= 30
	GeometryHeight		= 230
	GeometryOffset		= X:3 Y:8 Z:0

	AdditionalGeometry	= CYLINDER
	GeometryMajorRadius	= 20
	GeometryHeight		= 145
	GeometryOffset		= X:-22 Y:-80 Z:0


	AdditionalGeometry	= CYLINDER
	GeometryMajorRadius	= 20
	GeometryHeight		= 95
	GeometryOffset		= X:77 Y:-50 Z:0


	AdditionalGeometry	= CYLINDER
	GeometryMajorRadius	= 30
	GeometryHeight		= 130
	GeometryOffset		= X:-40 Y:66 Z:0

	AttackContactPoint	= X:10 Y:-105 Z:15
	AttackContactPoint	= X:-20 Y:-105 Z:15
	AttackContactPoint	= X:30 Y:-105 Z:15
	AttackContactPoint	= X:-5 Y:-105 Z:15

	GeometryIsSmall		= No
	Shadow			= SHADOW_VOLUME
End
 