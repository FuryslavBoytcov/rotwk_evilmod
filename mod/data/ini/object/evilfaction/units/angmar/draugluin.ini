;================================================================================
;Draugluin the Werewolf captain

Object AngmarDraugluin
	; *** ART Parameters ***
    
	; This is required for garrisoned objects - please put in all objects.
	ButtonImage = BIDrauglin

	SelectPortrait = HPDraugluin ;UPNeutral_WargNew

	DescriptionStrategic = CONTROLBAR:LW_ToolTipBuild_WormTongue

	Draw = W3DHordeModelDraw ModuleTag_01

		OkToChangeModelColor = Yes

		ExtraPublicBone	= B_PASSENGER01
		ExtraPublicBone = ZZZWHIPCOIL
		ExtraPublicBone = SWORD

		;-------------------------
		ModelConditionState = NONE ; Not DefaultConditionState, because that keyword copies anything in here to every other state
			Model = KUWWolf_SKN
                        Texture = KUWWolf.tga iudrgluinskn.tga
                        Texture = EXWolfEyes.tga EXLnzFlarRed2.tga
			ParticleSysBone = None Draugluin_Ambient_fog01
			ParticleSysBone = None Draugluin_Ambient_Embers01
			ParticleSysBone = "Bip L Finger2" Draugluin_Ambient_fog FollowBone:YES	;"BIP L HAND"
			ParticleSysBone = "Bip L Finger2" Draugluin_Ambient_Embers FollowBone:YES
			ParticleSysBone = "Bip R Finger2" Draugluin_Ambient_fog FollowBone:YES	;"BIP R HAND"
			ParticleSysBone = "Bip R Finger2" Draugluin_Ambient_Embers FollowBone:YES
		End


		ModelConditionState			= USER_3
			Model = KUWWolf_SKN
                        Texture = KUWWolf.tga iudrgluinskn.tga
                        Texture = EXWolfEyes.tga EXLnzFlarRed2.tga
			ParticleSysBone = None Draugluin_Ambient_fog01
			ParticleSysBone = None Draugluin_Ambient_Embers01
			ParticleSysBone = "Bip L Finger2" Draugluin_Ambient_fog FollowBone:YES	;"BIP L HAND"
			ParticleSysBone = "Bip L Finger2" Draugluin_Ambient_Embers FollowBone:YES
			ParticleSysBone = "Bip R Finger2" Draugluin_Ambient_fog FollowBone:YES	;"BIP R HAND"
			ParticleSysBone = "Bip R Finger2" Draugluin_Ambient_Embers FollowBone:YES
		End

		;-----------------		
		IdleAnimationState
			StateName = State_Idle
			Animation = Breathe 
				AnimationName = KUWWolf_SKL.KUWWolf_IDLA
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 3
			End
			Animation = LookAround 
				AnimationName = KUWWolf_SKL.KUWWolf_IDLB
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 2
			End
			Animation = SnortLikeABull 
				AnimationName = KUWWolf_SKL.KUWWolf_IDLC
				AnimationMode = ONCE
				AnimationBlendTime = 10
				AnimationPriority = 1
			End

			BeginScript
				Prev = CurDrawablePrevAnimationState()
				if Prev == "State_JustBuilt" 
					then CurDrawableSetTransitionAnimState("TRANS_JustBuilt_To_Idle") 
				end
				if Prev == "State_AboutToHitGround" 
					then CurDrawableSetTransitionAnimState("TRANS_AboutToHitGround_To_Idle") 
				end
			EndScript
			ParticleSysBone = None SoWolf_Ambient_snowFollowBone:YES
		End 
		
		AnimationState					=	DYING DEATH_1
			Animation				=	Dying 
				AnimationName			=	KUWWolf_SKL.KUWWolf_DIEA 
				AnimationMode			=	ONCE
			End
			;ParticleSysBone = None BalrogFallDust FollowBone:No
		End

		AnimationState					=	DYING DEATH_2
			Animation				=	FadingOut 
				AnimationName			=	KUWWolf_SKL.KUWWolf_RORA 
				AnimationMode			=	ONCE
			End
		End


		
		AnimationState					=	EATING
			FrameForPristineBonePositions 		= 99
			Animation				=	DoingHorribleThingToGrabbedGuy 
				AnimationName			=	KUWWolf_SKL.KUWWolf_SPCC
				AnimationMode			=	ONCE
				AnimationBlendTime		=	0
			End

		End

;		AnimationState					=	UNPACKING PACKING_TYPE_3
;			Animation					=	GrabbingToTouching
;				AnimationName			=	KUWWolf_SKL.KUWWolf_GRBA 
;				AnimationMode			=	ONCE
;				AnimationBlendTime		=	0
;			End
;		End
;
;		AnimationState					=	PACKING PACKING_TYPE_3
;			Animation					=	GrabbingFollowThrough 
;				AnimationName			=	KUWWolf_SKL.KUWWolf_GRBC 
;				AnimationMode			=	ONCE
;				AnimationBlendTime		=	0
;			End	
;		End

		AnimationState			= JUST_BUILT
			StateName = State_JustBuilt
			Animation
				AnimationName = KUWWolf_SKL.KUWWolf_RORA
				AnimationMode = MANUAL
				AnimationBlendTime = 0
			End
		End
		
	    TransitionState = TRANS_JustBuilt_To_Idle
			Animation = BeingSummoned
				AnimationName = KUWWolf_SKL.KUWWolf_RORA 
				AnimationMode = ONCE
			End
		FXEvent	= Frame:2 Name: FX_ShadowPortalBuild
		End
		
		AnimationState = FIRING_OR_PREATTACK_B
			Animation = CrackThatWhip 
				AnimationName = KUWWolf_SKL.KUWWolf_WIPA
				AnimationMode = ONCE
			End
				;ParticleSysBone = RTHANDBONE BalrogWhip2swordEfx FollowBone:Yes
		End
			   
		AnimationState			= SPECIAL_WEAPON_ONE
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_SPCB
				AnimationMode   = ONCE
			End
		End
			   
		AnimationState			= SPECIAL_WEAPON_TWO
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_CHRA
				AnimationMode   = ONCE
			End
		End
			   
	    AnimationState			= SPECIAL_WEAPON_THREE
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_SPCA
				AnimationMode   = ONCE
			End
		End
		
		AnimationState			= TURN_RIGHT
			Animation			= TurningRight 
				AnimationName	= KUWWolf_SKL.KUWWolf_TRNR
				AnimationMode   = LOOP
				AnimationBlendTime = 50
			End
		End

		AnimationState			= TURN_LEFT
			Animation			= TurningLeft 
				AnimationName	= KUWWolf_SKL.KUWWolf_TRNL
				AnimationMode   = LOOP
				AnimationBlendTime = 50
			End
		End

		AnimationState				= MOVING
			Animation			= Running 
				AnimationName		= KUWWolf_SKL.KUWWolf_RUNA
				AnimationMode   	= LOOP
				AnimationBlendTime 	= 10
				Distance		= 112

			End
			Flags               		= RANDOMSTART
			
		End
      
				
		AnimationState			= FIRING_OR_PREATTACK_A
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_ATKA
				AnimationMode	= ONCE
				UseWeaponTiming	= Yes
			End
			Animation			
				AnimationName	= KUWWolf_SKL.KUWWolf_ATKB
				AnimationMode	= ONCE
				UseWeaponTiming	= Yes
			End
;			Animation			
;				AnimationName	= KUWWolf_SKL.KUWWolf_SPCA
;				AnimationMode   = ONCE
;			End
			FXEvent	= Frame:20 Name: FX_DraugluinWerewolfHit
		End
		
	End

	MaxSimultaneousOfType		= 1

	; ***DESIGN parameters ***
	Side = Angmar
	EditorSorting = UNIT
	ThreatLevel = BALROG_THREAT_LEVEL
    ThingClass = CHARACTER_UNIT

    CrusherLevel   = 0;4  ;What can I crush?: 1 = infantry, 2 = trees, 3 = vehicles
    ;CrushWeapon = BalrogCrush  
    ;MinCrushVelocityPercent = 40         ; Has to be moving at at least 35% of full speed.
    ;CrushDecelerationPercent = 10         ; Lose 20 percent of max velocity when crushing.
    
    CrushKnockback     = 40;
    CrushZFactor     = 1.0;

    DisplayMeleeDamage = 1100
    BuildCost = 20000
    BuildTime = 60

    Scale = 1.4

    TransportSlotCount = TRANSPORTSLOTCOUNT_MONSTER
    
    WeaponSet
        Conditions = None
        Weapon = PRIMARY    DraugluinWeapon
    End
    
    ArmorSet
        Conditions      = None
        Armor           = ShadeofWolfArmor_FEM
        DamageFX        = NormalDamageFX
    End

    VisionRange = VISION_RANGE_MAX_EXTENT                   
    ShroudClearingRange = 400

    ShockwaveResistance = SHOCKWAVE_RESISTANCE_ALWAYS
    CommandSet = ShadeofWolfCommandSet
    CanPathThroughGates    = Yes;No
   // IsTrainable = No
    
    DeadCollideSize = LARGE ; How big does the AOD consider this unit for damage fx & behavior.


    ;------------------ AUDIO Parameters ----------------------

    VoiceAttack            = ShadeWolfAttack
    VoiceAttackCharge        = ShadeWolfAttack
    VoiceAttackMachine    = ShadeWolfAttack
    VoiceAttackStructure    = ShadeWolfAttack
    VoiceGuard            = ShadeWolfIdle
    VoiceMove            = ShadeWolfIdle
    VoiceSelect            = ShadeWolfIdle
    VoiceSelectBattle        = ShadeWolfIdle

    SoundAmbient        = ShadeWolfIdle
    SoundImpact            = ImpactHorse

    #include "..\..\..\includes\StandardUnitEvaEvents.inc"
    
    ; Warn the player when the enemy gets a unit. Override the normal sighting event from StandardUnitEvaEvents.inc
    EvaEnemyObjectSightedEvent    = DiscoveredEnemyBalrog

;    ClientUpdate = EvaAnnounceClientCreate ModuleTag_CreateAnnounce
;        AnnouncementEventEnemy = DiscoveredEnemyBalrog
;        AnnouncementEventAlly = None
;        AnnouncementEventOwner = None
;        
;        OnlyIfVisible = Yes                        ; Don't announce if hidden in the shroud
;        CountAsFirstSightedAnnoucement = Yes    ; Don't re-annouce if going into shroud & back
;        UseObjectsPosition = No                    ; Play from central Fortress, not at unit's position
;        CreateFakeRadarEvent = Yes                ; Allow player to jump to unit after hearing annoucement
;    End

    ClientBehavior = AnimationSoundClientBehavior ModuleTag_AnimAudioBehavior
        MaxUpdateRangeCap = 800
        AnimationSound = Sound: BalrogFootstep            Animation: KUWWolf_SKL.KUWWolf_RUNA Frames: 42 17 
        AnimationSound = Sound: BalrogFootstep            Animation: KUWWolf_SKL.KUWWolf_TRNR Frames: 21 52
        AnimationSound = Sound: BalrogFootstep            Animation: KUWWolf_SKL.KUWWolf_TRNL Frames: 21 52
 
        AnimationSound = Sound: ShadeWolfSummonPack        Animation: KUWWolf_SKL.KUWWolf_SPCB Frames: 1 
        AnimationSound = Sound: ShadeWolfLament            Animation: KUWWolf_SKL.KUWWolf_CHRA Frames: 21 

        AnimationSound = Sound: ShadeWolfSummonHowl        Animation: KUWWolf_SKL.KUWWolf_DIEA Frames: 25
        AnimationSound = Sound: ShadeWolfSummonHowl        Animation: KUWWolf_SKL.KUWWolf_RORA Frames: 21
        AnimationSound = Sound: ShadeWolfSummonHowl        Animation: KUWWolf_SKL.KUWWolf_SPCC Frames: 50

    End


  ; *** ENGINEERING Parameters ***  

    RadarPriority = UNIT
  KindOf          = HERO PRELOAD SELECTABLE CAN_CAST_REFLECTIONS MONSTER SCORE CAN_ATTACK NO_FREEWILL_ENTER PATH_THROUGH_INFANTRY SCARY BIG_MONSTER CAN_ATTACK_WALLS SUMMONED //ARMY_OF_DEAD
  ThreatBreakdown MordorBalrog_DetailedThreat
    AIKindOf = SIEGEWEAPON
  End
    
  Body            = ActiveBody ModuleTag_02
    MaxHealth         = DRAU_HEALTH
	MaxHealthDamaged		= MAX_HEALTH_DAMAGED_SHADOW_AND_GHOST              
  End

  Behavior = StancesBehavior ModuleTag_StancesBehavior
    StanceTemplate = FighterHorde
  End

  Behavior = AIUpdateInterface ModuleTag_03
    AutoAcquireEnemiesWhenIdle    = Yes ATTACK_BUILDINGS
    MoodAttackCheckRate            = 500
    AILuaEventsList                = BalrogFunctions
  End

  LocomotorSet
    Locomotor     = ShadeofWolfLocomotor
    Condition     = SET_NORMAL
    Speed         = 144
  End

    Behavior = PhysicsBehavior ModuleTag_04
        GravityMult = 1.0
    End
;кевемхе------------------------------------
  
	Behavior = AutoHealBehavior ModuleTag_GandalfHealing
		StartsActive = Yes
		HealingAmount = 20
		HealingDelay = 0
		StartHealingDelay = 25000
		HealOnlyIfNotInCombat = Yes
	End  
;кевемхе------------------------------------

      Behavior = SlowDeathBehavior ModuleTag_05
        DeathTypes = ALL -FADED //+feded
        DestructionDelay = 6000
        FadeDelay            = 4200
        FadeTime            = 3000  
       	FX = INITIAL FX_GandalfBlast
	FX = FINAL FX_SpecialForShadeWolf
            DeathFlags = DEATH_1
     Weapon				= FINAL ShadeWolfDeath
    End
  
      Behavior = SlowDeathBehavior ModuleTag_FadeDeath 
        DeathTypes = NONE +FADED
        DestructionDelay = 3850
        FadeDelay            = 1000
        FadeTime            = 2666
            FX = INITIAL FX_SoWolfUnsummon
    ;new        
//FX = FINAL FX_GandalfBlast
//FX = FINAL FX_RingHeroBlast
//FX = FINAL FX_SpecialForShadeWolf
            DeathFlags = DEATH_2
//Weapon				= FINAL ShadeWolfDeath
    End
  
  
;--------------------------------SPECIAL ABILITIES--------------------------------------------------  
;-------------------------------------BLINK (Teleport) SPELL-----------------------------------------------------

	Behavior = SpecialPowerModule ModuleTag_TeleportStarter                      
		SpecialPowerTemplate	 = SpecialAbilityBlink
		UpdateModuleStartsAttack = Yes
		TriggerFX		= FX_Blink_FOR_EVIL_MOD;FX_Blink
		StartsPaused		= No
	End
	Behavior = TeleportSpecialAbilityUpdate ModuleTag_TeleportUpdate   
		SpecialPowerTemplate  =	SpecialAbilityBlink
	
		//UnpackingVariation	  =	1
		//UnpackTime		 =	1;1800
		//PackTime		=	1;1800
	
		ApproachRequiresLOS	  =	No
		BusyForDuration		  =	1 // don't accept	any	AI for this	long...	ai commands	will be	queued (should be at least PackTime)
		
		DestinationWeaponName =	blink_for_karsh;CreateaHeroBlinkDestination	// Fires	at point of	teleport to	push people	away and down.
	End

    ;;;; DARK LORD'S LAMENT SPECIAL ABILITY ;;;;;;;;--------------------------------------------------------------------

    Behavior = SpecialPowerModule ModuleTag_LamentStarter       
        SpecialPowerTemplate      = SpecialAbilityDarkLordsLament
        UpdateModuleStartsAttack  = Yes
        StartsPaused          = No
        InitiateSound        = BalrogRoar
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_LamentWeaponFireUpdate   
        SpecialPowerTemplate    = SpecialAbilityDarkLordsLament
        SpecialWeapon            = AngmarDarkLordsLamentWeapon_FEM
        WhichSpecialWeapon        = 2            ; Corresponds to SPECIAL_WEAPON_THREE
        StartAbilityRange        = 10.0
        
        SkipContinue            = Yes
        UnpackTime            = 1000     ; Trigger on frame 60 (of 100)
        PackTime            = 2000        ; Remaining 40 frames (of 100)
        MustFinishAbility        = Yes
    End

    ;------------------- Call The PAck ------------------
  
    
    Behavior = SpecialPowerModule ModuleTag_CallPackStarter                      
        SpecialPowerTemplate        = SpecialAbilityCallPack
        TriggerFX             = FX_SoWolf_SummonPack
        UpdateModuleStartsAttack    = Yes
        StartsPaused            = No
        InitiateSound            = WargHowlAbility
    End

    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_FloodUpdate   
        SpecialPowerTemplate    = SpecialAbilityCallPack

        UnpackTime              = 500
        PackTime                = 1000

        StartAbilityRange     = 100.0
        
        SpecialWeapon         = ShadeCallthePack
        WhichSpecialWeapon     = 1
    End
    
    
    ;//----------------------Man Eater-----------------------------------------------    


    Behavior = SpecialPowerModule ModuleTag_SpecialPowerModuleGrabStarter
        SpecialPowerTemplate        = SpecialAbilityAngmarShadeEatMeGrab
        UpdateModuleStartsAttack    = Yes
        StartsPaused            = No
        InitiateSound            = BalrogChuckle
    End
    
    Behavior = WeaponFireSpecialAbilityUpdate ModuleTag_WeaponFireSpecialAbilityUpdateGrab
        SpecialPowerTemplate        = SpecialAbilityAngmarShadeEatMeGrab
        SkipContinue            = Yes
        UnpackTime            = 533                        ; Frame 28/99
;        PackTime            = 2367                        ; Remaining 71/99 frames
        
        StartAbilityRange        = 12.0
        
        SpecialWeapon            = AngmarShadeChompWeapon
        ChainedButton            = Command_SpecialAbilityShadeChompFlingPassenger
        CustomAnimAndDuration        = AnimState:EATING AnimTime:3333
        MustFinishAbility        = Yes

        TriggerAttributeModifier    = SharkuManEater
        AttributeModifierDuration    = 20000
        TriggerSound                = SharkuManEaterEatingMS
        BusyForDuration                = 5000
    End

    Behavior = PlayerHealSpecialPower ModuleTag_SpecialPowerModuleFlingPassengerStarter
        SpecialPowerTemplate        = SpecialAbilityAngmarShadeEatMeDrop
        UpdateModuleStartsAttack    = Yes
        StartsPaused            = No
        HealAmount            = 1.0
        HealAsPercent            = Yes
        HealAffects            = HERO
        HealRadius            = 0.0
        HealFX                = FX_SpellHealUnitHealBuff
    End

    Behavior = FlingPassengerSpecialAbilityUpdate ModuleTag_FlingPassengerSpecialAbilityUpdate
        SpecialPowerTemplate            = SpecialAbilityAngmarShadeEatMeDrop
        UnpackTime                = 1250
        FlingPassengerVelocity            = X:0 Y:0 Z:0
        FlingPassengerLandingWarhead        = AngmarShadeChompWarhead    ;kills victim when released
        MustFinishAbility        = Yes
    End        
    
    Behavior = TransportContain ModuleTag_09
        ObjectStatusOfContained = UNSELECTABLE
        PassengerFilter            = ANY +INFANTRY
;        ManualPickUpFilter        = NONE +INFANTRY ; we do not want the user to be able to manually pick up an orc with a troll.
        Slots                    = 1
        ShowPips                = No
        AllowEnemiesInside        = Yes
        AllowNeutralInside        = Yes
        AllowAlliesInside        = No
        ;DamagePercentToUnits    = 500%
        DestroyRidersWhoAreNotFreeToExit = Yes
        ForceOrientationContainer = No
        PassengerBonePrefix = PassengerBone:B_PASSENGER01        KindOf:INFANTRY
;        EjectPassengersOnDeath = Yes
    End

	Behavior = StealthDetectorUpdate ModuleTag_10
		DetectionRate   = 500   ; how often to rescan for stealthed things in my sight (msec)
		DetectionRange = 50000 ; enable this for independant balancing!
		CanDetectWhileGarrisoned  = Yes ;Garrisoned means being in a structure that you units can shoot out of.
		CanDetectWhileContained   = Yes ;Contained means being in a transport or tunnel network.
	End
	

        ;;;AI SECTION;;;

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceBattle
		CommandButtonName = Command_SetStanceBattle
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEBATTLE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeStanceAggressive
		CommandButtonName = Command_SetStanceAggressive
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEAGGRESSIVE
	End

	Behavior = AISpecialPowerUpdate GondorFighterHordeHoldGround
		CommandButtonName = Command_SetStanceHoldGround
		SpecialPowerAIType = AI_SPECIAL_POWER_STANCEHOLDGROUND
	End

	

        Scale = 1.9

	HealthBoxScale			= 2.0
	HealthBoxHeightOffset	= 6.0	

	Geometry			= CYLINDER
	GeometryMajorRadius = 18.0
	GeometryHeight		= 90.0
  	GeometryOffset		= X:-20 Y:0 Z:0
	GeometryIsSmall		= No
	
	Shadow				= SHADOW_VOLUME ;SHADOW_DECAL	; SHADOW_VOLUME has trouble with his wings.  Possibly because of the transparent bits
	ShadowSizeX			= 100
	ShadowSizeY			= 100
	ShadowTexture		= ShadowI
End


